<meta charset="utf-8"> <link rel="stylesheet" href="other/lhs.css">
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<h1 id="haskell-rl-rental-car-problem-ex.-4.7-from-sutton-bartow">haskell-rl : Rental Car Problem (Ex. 4.7 from Sutton &amp; Bartow)</h1>
<p>This <a href="https://wiki.haskell.org/Literate_programming">literate Haskell</a> document provides a solution to Exercise 4.7 in <em>Reinforcement Learning</em> by Sutton &amp; Barotw.</p>
<p>Original author: <a href="mailto:David.Banas@target.com">David Banas</a><br />
Original date: April 20, 2018</p>
<p>Copyright Â© 2018 Target Corp.; all rights reserved World wide.</p>
<h2 id="contents">Contents</h2>
<ul class="incremental">
<li><a href="#code">Code</a></li>
<li><a href="#output">Output</a></li>
</ul>
<h2 id="code">code</h2>
<h2 id="ghc-options"><a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/flags.html#flag-reference">ghc options</a></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ot">{-# OPTIONS_GHC -Wall #-}</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="ot">{-# OPTIONS_GHC -fno-warn-type-defaults #-}</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="ot">{-# OPTIONS_GHC -Wno-missing-signatures #-}</span></a></code></pre></div>
<h2 id="pragmas"><a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/lang.html">pragmas</a></h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">-- doctest doesn&#39;t look at the cabal file, so you need pragmas here</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="ot">{-# LANGUAGE NoImplicitPrelude #-}</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="ot">{-# LANGUAGE DataKinds #-}</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="ot">{-# LANGUAGE DeriveGeneric #-}</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="ot">{-# LANGUAGE ScopedTypeVariables #-}</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="ot">{-# LANGUAGE TypeOperators #-}</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="ot">{-# LANGUAGE FlexibleInstances #-}</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="ot">{-# LANGUAGE BangPatterns #-}</span></a></code></pre></div>
<h2 id="libraries"><a href="https://www.stackage.org/">libraries</a></h2>
<ul class="incremental">
<li><a href="https://www.stackage.org/package/protolude">protolude</a></li>
<li><a href="https://www.stackage.org/package/optparse-generic">optparse-generic</a></li>
<li><a href="https://www.stackage.org/package/vector-sized">vector-sized</a></li>
<li><a href="https://www.stackage.org/package/finite-typelits">finite-typelits</a></li>
<li><a href="https://www.stackage.org/package/extra">extra</a></li>
<li><a href="https://www.stackage.org/package/finite-typelits">finite-typelits</a></li>
<li><a href="https://www.stackage.org/package/text">text</a></li>
<li><a href="https://www.stackage.org/package/random">random</a></li>
<li><a href="https://www.stackage.org/package/random-shuffle">random-shuffle</a></li>
<li><a href="https://www.stackage.org/package/Chart">Chart</a></li>
<li><a href="https://www.stackage.org/package/Chart-cairo">Chart-cairo</a></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Prelude</span> <span class="kw">as</span> <span class="dt">P</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">-- import Prelude (tail, last, unlines, String, Show(..))</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw">import</span> <span class="dt">Prelude</span> (unlines, <span class="dt">Show</span>(..), <span class="dt">String</span>)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="kw">import</span> <span class="dt">Protolude</span>  <span class="kw">hiding</span> (show, for)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="kw">import</span> <span class="dt">Options.Generic</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">-- import qualified Data.Vector.Sized   as VS</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">-- import qualified Data.Vector.Unboxed as V</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="kw">import</span> <span class="dt">Control.Arrow</span>              ((&amp;&amp;&amp;), (***))</a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">-- import Control.Monad.Extra        (unfoldM)</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">-- import Data.Finite</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="kw">import</span> <span class="dt">Data.List</span>                  (groupBy)</a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="kw">import</span> <span class="dt">Data.Text</span>                  (pack)</a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">-- import System.Random              (randomIO)</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">-- import System.Random.Shuffle      (shuffleM)</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="kw">import</span> <span class="dt">Text.Printf</span>                (printf)</a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="co">-- import Test.QuickCheck            (generate, elements)</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="kw">import</span> <span class="dt">Graphics.Rendering.Chart.Easy</span> <span class="kw">hiding</span> (<span class="dt">Wrapped</span>, <span class="dt">Empty</span>)</a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="kw">import</span> <span class="dt">Graphics.Rendering.Chart.Backend.Cairo</span></a></code></pre></div>
<h2 id="code-1">code</h2>
<ul class="incremental">
<li><a href="https://www.stackage.org/package/hoogle">hoogle</a></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">{----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">  Command line options defintions.</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">----------------------------------------------------------------------}</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="kw">data</span> <span class="dt">Opts</span> w <span class="fu">=</span> <span class="dt">Opts</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">    {</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">    <span class="co">-- { number :: w ::: Maybe Integer &lt;?&gt; &quot;The number of games to play&quot;</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">    <span class="co">-- , rate   :: w ::: Maybe Double  &lt;?&gt; &quot;The learning rate&quot;</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">    }</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">    <span class="kw">deriving</span> (<span class="dt">Generic</span>)</a>
<a class="sourceLine" id="cb4-11" data-line-number="11"></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="kw">instance</span> <span class="dt">ParseRecord</span> (<span class="dt">Opts</span> <span class="dt">Wrapped</span>)</a>
<a class="sourceLine" id="cb4-13" data-line-number="13"></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">{----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">  General policy iterator</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">----------------------------------------------------------------------}</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">-- | An optimum policy, given:</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">--   - p(s&#39;, r | s, a) - pdf of (next_state, reward),</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co">--                       given (current_state, action),</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="co">--   - S&#39;(s, a)        - all possible next states, for a given state/action pair,</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">--   - R(s, a, s&#39;)     - all possible rewards for a given state/action/next-state triple,</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="co">--   - A(s)            - all actions possible in state s, and</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="co">--   - S               - all possible states.</span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="co">--</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="co">-- Note: In the code, the first 3 elements above are combined into a</span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="co">--       single input function (first argument, below), which combines</span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29"><span class="co">--       the pdf with the 2 needed generators (i.e. - one for next states,</span></a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="co">--       and another for rewards).</span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31"><span class="co">--</span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="co">-- Note: I use the pure random number generator, instead of its IO</span></a>
<a class="sourceLine" id="cb4-33" data-line-number="33"><span class="co">--       counterpart, for two reasons:</span></a>
<a class="sourceLine" id="cb4-34" data-line-number="34"><span class="co">--       - It allows me to keep this function pure, as opposed to</span></a>
<a class="sourceLine" id="cb4-35" data-line-number="35"><span class="co">--         running it inside the IO monad.</span></a>
<a class="sourceLine" id="cb4-36" data-line-number="36"><span class="co">--       - Initialized with a constant &#39;1&#39;, the way it is here, it</span></a>
<a class="sourceLine" id="cb4-37" data-line-number="37"><span class="co">--         provides the same stream of pseudo-random numbers each time</span></a>
<a class="sourceLine" id="cb4-38" data-line-number="38"><span class="co">--         the program is run. This repeatability is a nice feature,</span></a>
<a class="sourceLine" id="cb4-39" data-line-number="39"><span class="co">--         during program development/debug.</span></a>
<a class="sourceLine" id="cb4-40" data-line-number="40"><span class="co">--       (Note, however, that it should be replaced by its IO</span></a>
<a class="sourceLine" id="cb4-41" data-line-number="41"><span class="co">--       counterpart, once the code is stable, so as to provide better</span></a>
<a class="sourceLine" id="cb4-42" data-line-number="42"><span class="co">--       corner case exposure.)</span></a>
<a class="sourceLine" id="cb4-43" data-line-number="43"><span class="co">--</span></a>
<a class="sourceLine" id="cb4-44" data-line-number="44"><span class="co">-- TODO: Make second argument to optPol&#39; general, perhaps by choosing</span></a>
<a class="sourceLine" id="cb4-45" data-line-number="45"><span class="co">--       randomly from among the legal actions for a given state.</span></a>
<a class="sourceLine" id="cb4-46" data-line-number="46"><span class="ot">optPol ::</span> <span class="dt">Num</span> a  <span class="co">-- TEMPORARY; See TODO above.</span></a>
<a class="sourceLine" id="cb4-47" data-line-number="47">       <span class="ot">=&gt;</span> <span class="dt">Integer</span>                              <span class="co">-- ^ max. iterations</span></a>
<a class="sourceLine" id="cb4-48" data-line-number="48">       <span class="ot">-&gt;</span> (s <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [(s, [(<span class="dt">Float</span>, <span class="dt">Float</span>)])])  <span class="co">-- ^ pdf (filtered for non-zero probs.)</span></a>
<a class="sourceLine" id="cb4-49" data-line-number="49">       <span class="ot">-&gt;</span> <span class="dt">Float</span>                                <span class="co">-- ^ convergence tolerance</span></a>
<a class="sourceLine" id="cb4-50" data-line-number="50">       <span class="ot">-&gt;</span> <span class="dt">Float</span>                                <span class="co">-- ^ discount rate</span></a>
<a class="sourceLine" id="cb4-51" data-line-number="51">       <span class="ot">-&gt;</span> (s <span class="ot">-&gt;</span> [a])                           <span class="co">-- ^ A(s)</span></a>
<a class="sourceLine" id="cb4-52" data-line-number="52">       <span class="ot">-&gt;</span> [s]                                  <span class="co">-- ^ S</span></a>
<a class="sourceLine" id="cb4-53" data-line-number="53">       <span class="ot">-&gt;</span> ([s <span class="ot">-&gt;</span> a], [[((s <span class="ot">-&gt;</span> <span class="dt">Float</span>), <span class="dt">Float</span>)]])</a>
<a class="sourceLine" id="cb4-54" data-line-number="54">optPol <span class="fu">=</span> optPol&#39; [[((const <span class="dv">0</span>), <span class="dv">0</span>)]] [const <span class="dv">0</span>] <span class="dv">0</span></a>
<a class="sourceLine" id="cb4-55" data-line-number="55"></a>
<a class="sourceLine" id="cb4-56" data-line-number="56"><span class="ot">optPol&#39; ::</span> forall s a<span class="fu">.</span></a>
<a class="sourceLine" id="cb4-57" data-line-number="57">           [[((s <span class="ot">-&gt;</span> <span class="dt">Float</span>), <span class="dt">Float</span>)]]          <span class="co">-- ^ previous evalPol results</span></a>
<a class="sourceLine" id="cb4-58" data-line-number="58">        <span class="ot">-&gt;</span> [s <span class="ot">-&gt;</span> a]                         <span class="co">-- ^ results from previous iterations</span></a>
<a class="sourceLine" id="cb4-59" data-line-number="59">        <span class="ot">-&gt;</span> <span class="dt">Integer</span>                          <span class="co">-- ^ iterations so far</span></a>
<a class="sourceLine" id="cb4-60" data-line-number="60">        <span class="ot">-&gt;</span> <span class="dt">Integer</span></a>
<a class="sourceLine" id="cb4-61" data-line-number="61">        <span class="ot">-&gt;</span> (s <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [(s, [(<span class="dt">Float</span>, <span class="dt">Float</span>)])])</a>
<a class="sourceLine" id="cb4-62" data-line-number="62">        <span class="ot">-&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="cb4-63" data-line-number="63">        <span class="ot">-&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="cb4-64" data-line-number="64">        <span class="ot">-&gt;</span> (s <span class="ot">-&gt;</span> [a])</a>
<a class="sourceLine" id="cb4-65" data-line-number="65">        <span class="ot">-&gt;</span> [s]</a>
<a class="sourceLine" id="cb4-66" data-line-number="66">        <span class="ot">-&gt;</span> ([s <span class="ot">-&gt;</span> a], [[((s <span class="ot">-&gt;</span> <span class="dt">Float</span>), <span class="dt">Float</span>)]])</a>
<a class="sourceLine" id="cb4-67" data-line-number="67">optPol&#39; vs pols nIter maxIter gen eps gamma asofs ss <span class="fu">=</span></a>
<a class="sourceLine" id="cb4-68" data-line-number="68">  <span class="kw">if</span> nIter <span class="fu">&gt;=</span> maxIter <span class="fu">||</span> stable</a>
<a class="sourceLine" id="cb4-69" data-line-number="69">    <span class="kw">then</span> (reverse pols, reverse vs)</a>
<a class="sourceLine" id="cb4-70" data-line-number="70">    <span class="co">-- else optPol&#39; v&#39; (pol&#39; : pols) (nIter + 1) maxIter gen eps gamma asofs ss</span></a>
<a class="sourceLine" id="cb4-71" data-line-number="71">    <span class="kw">else</span> optPol&#39; (vofss <span class="fu">:</span> vs) (pol&#39; <span class="fu">:</span> pols) (nIter <span class="fu">+</span> <span class="dv">1</span>) maxIter gen eps gamma asofs ss</a>
<a class="sourceLine" id="cb4-72" data-line-number="72"> <span class="kw">where</span> stable  <span class="fu">=</span> none ( uncurry (<span class="fu">&lt;</span>)</a>
<a class="sourceLine" id="cb4-73" data-line-number="73">                        <span class="fu">.</span> ( (uncurry (actVal gamma gen v) <span class="fu">.</span> (P.id <span class="fu">&amp;&amp;&amp;</span> P.head pols))</a>
<a class="sourceLine" id="cb4-74" data-line-number="74">                            <span class="fu">&amp;&amp;&amp;</span> (snd <span class="fu">.</span> bestA)</a>
<a class="sourceLine" id="cb4-75" data-line-number="75">                          )</a>
<a class="sourceLine" id="cb4-76" data-line-number="76">                      ) ss</a>
<a class="sourceLine" id="cb4-77" data-line-number="77">       v       <span class="fu">=</span> (fst <span class="fu">.</span> P.last <span class="fu">.</span> P.head) vs</a>
<a class="sourceLine" id="cb4-78" data-line-number="78">       vofss   <span class="fu">=</span> evalPol eps gamma <span class="dv">10</span> <span class="dv">0</span> gen pol&#39; ss (P.head vs)</a>
<a class="sourceLine" id="cb4-79" data-line-number="79">       pol&#39;    <span class="fu">=</span> fst <span class="fu">.</span> bestA</a>
<a class="sourceLine" id="cb4-80" data-line-number="80"><span class="ot">       bestA ::</span> s <span class="ot">-&gt;</span> (a, <span class="dt">Float</span>)</a>
<a class="sourceLine" id="cb4-81" data-line-number="81">       bestA s <span class="fu">=</span> maximumBy (compare <span class="ot">`on`</span> snd)</a>
<a class="sourceLine" id="cb4-82" data-line-number="82">                   [ (a, actVal gamma gen v s a)</a>
<a class="sourceLine" id="cb4-83" data-line-number="83">                   <span class="fu">|</span> a <span class="ot">&lt;-</span> asofs s</a>
<a class="sourceLine" id="cb4-84" data-line-number="84">                   ]</a>
<a class="sourceLine" id="cb4-85" data-line-number="85"></a>
<a class="sourceLine" id="cb4-86" data-line-number="86"><span class="co">-- | Policy evaluator</span></a>
<a class="sourceLine" id="cb4-87" data-line-number="87"><span class="co">--</span></a>
<a class="sourceLine" id="cb4-88" data-line-number="88"><span class="co">-- Returns a list of better and better approximations to the value</span></a>
<a class="sourceLine" id="cb4-89" data-line-number="89"><span class="co">-- function for a given policy, along with their deltas.</span></a>
<a class="sourceLine" id="cb4-90" data-line-number="90"><span class="ot">evalPol ::</span> <span class="dt">Float</span>                                <span class="co">-- ^ tolerance of convergence</span></a>
<a class="sourceLine" id="cb4-91" data-line-number="91">        <span class="ot">-&gt;</span> <span class="dt">Float</span>                                <span class="co">-- ^ discount rate</span></a>
<a class="sourceLine" id="cb4-92" data-line-number="92">        <span class="ot">-&gt;</span> <span class="dt">Integer</span>                              <span class="co">-- ^ max. iterations</span></a>
<a class="sourceLine" id="cb4-93" data-line-number="93">        <span class="ot">-&gt;</span> <span class="dt">Integer</span>                              <span class="co">-- ^ iterations so far</span></a>
<a class="sourceLine" id="cb4-94" data-line-number="94">        <span class="ot">-&gt;</span> (s <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [(s, [(<span class="dt">Float</span>, <span class="dt">Float</span>)])])  <span class="co">-- ^ pdf (filtered for non-zero probs.)</span></a>
<a class="sourceLine" id="cb4-95" data-line-number="95">        <span class="ot">-&gt;</span> (s <span class="ot">-&gt;</span> a)                             <span class="co">-- ^ policy to be evaluated</span></a>
<a class="sourceLine" id="cb4-96" data-line-number="96">        <span class="ot">-&gt;</span> [s]                                  <span class="co">-- ^ S (all possible states)</span></a>
<a class="sourceLine" id="cb4-97" data-line-number="97">        <span class="ot">-&gt;</span> [((s <span class="ot">-&gt;</span> <span class="dt">Float</span>), <span class="dt">Float</span>)]              <span class="co">-- ^ results of previous iterations</span></a>
<a class="sourceLine" id="cb4-98" data-line-number="98">        <span class="ot">-&gt;</span> [((s <span class="ot">-&gt;</span> <span class="dt">Float</span>), <span class="dt">Float</span>)]</a>
<a class="sourceLine" id="cb4-99" data-line-number="99">evalPol eps gamma maxIter nIter gen pol ss vofss <span class="fu">=</span></a>
<a class="sourceLine" id="cb4-100" data-line-number="100">  <span class="kw">if</span> nIter <span class="fu">&gt;=</span> maxIter <span class="fu">||</span> delta <span class="fu">&lt;</span> eps</a>
<a class="sourceLine" id="cb4-101" data-line-number="101">    <span class="kw">then</span> reverse ((vofs&#39;, delta) <span class="fu">:</span> vofss)</a>
<a class="sourceLine" id="cb4-102" data-line-number="102">    <span class="kw">else</span> evalPol eps gamma maxIter (nIter <span class="fu">+</span> <span class="dv">1</span>) gen pol ss ((vofs&#39;, delta) <span class="fu">:</span> vofss)</a>
<a class="sourceLine" id="cb4-103" data-line-number="103"> <span class="kw">where</span> delta   <span class="fu">=</span> maximum <span class="fu">$</span> map (abs <span class="fu">.</span> uncurry (<span class="fu">-</span>) <span class="fu">.</span> (vofs <span class="fu">&amp;&amp;&amp;</span> vofs&#39;)) ss</a>
<a class="sourceLine" id="cb4-104" data-line-number="104">       vofs&#39; s <span class="fu">=</span> actVal gamma gen vofs s (pol s)</a>
<a class="sourceLine" id="cb4-105" data-line-number="105">       vofs    <span class="fu">=</span> (fst <span class="fu">.</span> P.head) vofss</a>
<a class="sourceLine" id="cb4-106" data-line-number="106"></a>
<a class="sourceLine" id="cb4-107" data-line-number="107"><span class="co">-- | Action-value function.</span></a>
<a class="sourceLine" id="cb4-108" data-line-number="108"><span class="co">--</span></a>
<a class="sourceLine" id="cb4-109" data-line-number="109"><span class="co">-- Note: See the documentation for `optPol` for an explanation of the</span></a>
<a class="sourceLine" id="cb4-110" data-line-number="110"><span class="co">--       second argument.</span></a>
<a class="sourceLine" id="cb4-111" data-line-number="111"><span class="ot">actVal ::</span> <span class="dt">Float</span>                                <span class="co">-- ^ discount rate</span></a>
<a class="sourceLine" id="cb4-112" data-line-number="112">       <span class="ot">-&gt;</span> (s <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [(s, [(<span class="dt">Float</span>, <span class="dt">Float</span>)])])  <span class="co">-- ^ pdf (filtered for non-zero probs.)</span></a>
<a class="sourceLine" id="cb4-113" data-line-number="113">       <span class="ot">-&gt;</span> (s <span class="ot">-&gt;</span> <span class="dt">Float</span>)                         <span class="co">-- ^ value function</span></a>
<a class="sourceLine" id="cb4-114" data-line-number="114">       <span class="ot">-&gt;</span> s                                    <span class="co">-- ^ initial state</span></a>
<a class="sourceLine" id="cb4-115" data-line-number="115">       <span class="ot">-&gt;</span> a                                    <span class="co">-- ^ next action</span></a>
<a class="sourceLine" id="cb4-116" data-line-number="116">       <span class="ot">-&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="cb4-117" data-line-number="117">actVal gamma gen vofs s a <span class="fu">=</span></a>
<a class="sourceLine" id="cb4-118" data-line-number="118">  sum [ p <span class="fu">*</span> (r <span class="fu">+</span> gamma <span class="fu">*</span> vofs s&#39;)</a>
<a class="sourceLine" id="cb4-119" data-line-number="119">      <span class="fu">|</span> (s&#39;, rs) <span class="ot">&lt;-</span> gen s a</a>
<a class="sourceLine" id="cb4-120" data-line-number="120">      , (r, p)   <span class="ot">&lt;-</span> rs</a>
<a class="sourceLine" id="cb4-121" data-line-number="121">      ]</a>
<a class="sourceLine" id="cb4-122" data-line-number="122"></a>
<a class="sourceLine" id="cb4-123" data-line-number="123"><span class="co">{----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-124" data-line-number="124"><span class="co">  Problem specific definitions</span></a>
<a class="sourceLine" id="cb4-125" data-line-number="125"><span class="co">----------------------------------------------------------------------}</span></a>
<a class="sourceLine" id="cb4-126" data-line-number="126"></a>
<a class="sourceLine" id="cb4-127" data-line-number="127">eps&#39; <span class="fu">=</span> <span class="fl">0.1</span>  <span class="co">-- my choice</span></a>
<a class="sourceLine" id="cb4-128" data-line-number="128">gamma&#39; <span class="fu">=</span> <span class="fl">0.9</span>  <span class="co">-- dictated by Exercise 4.7.</span></a>
<a class="sourceLine" id="cb4-129" data-line-number="129"></a>
<a class="sourceLine" id="cb4-130" data-line-number="130"><span class="kw">newtype</span> <span class="dt">RCState</span>  <span class="fu">=</span> <span class="dt">RCState</span> (<span class="dt">Int</span>, <span class="dt">Int</span>)  <span class="co">-- ^ # of cars at locations 1 &amp; 2</span></a>
<a class="sourceLine" id="cb4-131" data-line-number="131">  <span class="kw">deriving</span> (<span class="dt">Show</span>, <span class="dt">Eq</span>, <span class="dt">Ord</span>)</a>
<a class="sourceLine" id="cb4-132" data-line-number="132"></a>
<a class="sourceLine" id="cb4-133" data-line-number="133"><span class="kw">type</span>    <span class="dt">RCAction</span> <span class="fu">=</span> <span class="dt">Int</span>                 <span class="co">-- ^ # of cars to move from 1 to 2</span></a>
<a class="sourceLine" id="cb4-134" data-line-number="134"><span class="kw">type</span>    <span class="dt">Policy</span>   <span class="fu">=</span> <span class="dt">RCState</span> <span class="ot">-&gt;</span> <span class="dt">RCAction</span></a>
<a class="sourceLine" id="cb4-135" data-line-number="135"></a>
<a class="sourceLine" id="cb4-136" data-line-number="136"><span class="kw">instance</span> <span class="dt">Show</span> <span class="dt">Policy</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb4-137" data-line-number="137">  show p <span class="fu">=</span> unlines <span class="fu">$</span></a>
<a class="sourceLine" id="cb4-138" data-line-number="138">    <span class="co">-- [ printf ((concat . replicate 21) &quot;%2d  &quot;) (map p [RCState (m,n) | n &lt;- [0..20]])</span></a>
<a class="sourceLine" id="cb4-139" data-line-number="139">    [ P.unwords <span class="fu">.</span> map (show <span class="fu">.</span> p) <span class="fu">$</span> [<span class="dt">RCState</span> (m,n) <span class="fu">|</span> n <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">20</span>]]</a>
<a class="sourceLine" id="cb4-140" data-line-number="140">    <span class="fu">|</span> m <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">20</span>]</a>
<a class="sourceLine" id="cb4-141" data-line-number="141">    ]</a>
<a class="sourceLine" id="cb4-142" data-line-number="142"></a>
<a class="sourceLine" id="cb4-143" data-line-number="143"><span class="ot">allStates ::</span> [<span class="dt">RCState</span>]</a>
<a class="sourceLine" id="cb4-144" data-line-number="144">allStates <span class="fu">=</span> [<span class="dt">RCState</span> (m,n) <span class="fu">|</span> m <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">20</span>], n <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">20</span>]]</a>
<a class="sourceLine" id="cb4-145" data-line-number="145"></a>
<a class="sourceLine" id="cb4-146" data-line-number="146">pReq1 <span class="fu">=</span> poisson <span class="dv">3</span></a>
<a class="sourceLine" id="cb4-147" data-line-number="147">pReq2 <span class="fu">=</span> poisson <span class="dv">4</span></a>
<a class="sourceLine" id="cb4-148" data-line-number="148">pRet1 <span class="fu">=</span> poisson <span class="dv">3</span></a>
<a class="sourceLine" id="cb4-149" data-line-number="149">pRet2 <span class="fu">=</span> poisson <span class="dv">2</span></a>
<a class="sourceLine" id="cb4-150" data-line-number="150"></a>
<a class="sourceLine" id="cb4-151" data-line-number="151"><span class="co">-- | PDF generator, for original problem (i.e. - Example 4.2).</span></a>
<a class="sourceLine" id="cb4-152" data-line-number="152"><span class="ot">pdfGen ::</span> <span class="dt">RCState</span>   <span class="co">-- ^ current state</span></a>
<a class="sourceLine" id="cb4-153" data-line-number="153">       <span class="ot">-&gt;</span> <span class="dt">RCAction</span>  <span class="co">-- ^ next action</span></a>
<a class="sourceLine" id="cb4-154" data-line-number="154">       <span class="ot">-&gt;</span> [(<span class="dt">RCState</span>, [(<span class="dt">Float</span>, <span class="dt">Float</span>)])]</a>
<a class="sourceLine" id="cb4-155" data-line-number="155">pdfGen (<span class="dt">RCState</span> s) a <span class="fu">=</span></a>
<a class="sourceLine" id="cb4-156" data-line-number="156">  map ((P.head <span class="fu">***</span> map (first fromIntegral)) <span class="fu">.</span> unzip)</a>
<a class="sourceLine" id="cb4-157" data-line-number="157">  <span class="fu">.</span> groupBy ((<span class="fu">==</span>) <span class="ot">`on`</span> fst)</a>
<a class="sourceLine" id="cb4-158" data-line-number="158">  <span class="fu">.</span> sortOn fst</a>
<a class="sourceLine" id="cb4-159" data-line-number="159">  <span class="fu">$</span> [ ( <span class="dt">RCState</span> (( (<span class="fu">+</span> (nRet1 <span class="fu">-</span> a <span class="fu">-</span> nReq1)) <span class="fu">***</span> (<span class="fu">+</span> (nRet2 <span class="fu">+</span> a <span class="fu">-</span> nReq2)) ) s)</a>
<a class="sourceLine" id="cb4-160" data-line-number="160">      , ( <span class="dv">10</span> <span class="fu">*</span> (nReq1 <span class="fu">+</span> nReq2) <span class="fu">-</span> <span class="dv">2</span> <span class="fu">*</span> abs(a)</a>
<a class="sourceLine" id="cb4-161" data-line-number="161">        , product <span class="fu">$</span></a>
<a class="sourceLine" id="cb4-162" data-line-number="162">            zipWith (<span class="fu">$</span>) [pReq1, pRet1, pReq2, pRet2]</a>
<a class="sourceLine" id="cb4-163" data-line-number="163">                        [nReq1, nRet1, nReq2, nRet2]</a>
<a class="sourceLine" id="cb4-164" data-line-number="164">        )</a>
<a class="sourceLine" id="cb4-165" data-line-number="165">      )</a>
<a class="sourceLine" id="cb4-166" data-line-number="166">    <span class="fu">|</span> nRet1 <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">20</span><span class="fu">-</span>n1]</a>
<a class="sourceLine" id="cb4-167" data-line-number="167">    , nRet2 <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">20</span><span class="fu">-</span>n2]</a>
<a class="sourceLine" id="cb4-168" data-line-number="168">    , nReq1 <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span>n1<span class="fu">+</span>nRet1<span class="fu">-</span>a]</a>
<a class="sourceLine" id="cb4-169" data-line-number="169">    , nReq2 <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span>n2<span class="fu">+</span>nRet2<span class="fu">+</span>a]</a>
<a class="sourceLine" id="cb4-170" data-line-number="170">    ]</a>
<a class="sourceLine" id="cb4-171" data-line-number="171"> <span class="kw">where</span> n1 <span class="fu">=</span> fst s</a>
<a class="sourceLine" id="cb4-172" data-line-number="172">       n2 <span class="fu">=</span> snd s</a>
<a class="sourceLine" id="cb4-173" data-line-number="173"></a>
<a class="sourceLine" id="cb4-174" data-line-number="174"><span class="co">-- | A(s)</span></a>
<a class="sourceLine" id="cb4-175" data-line-number="175"><span class="ot">asOfS ::</span> <span class="dt">RCState</span> <span class="ot">-&gt;</span> [<span class="dt">RCAction</span>]</a>
<a class="sourceLine" id="cb4-176" data-line-number="176">asOfS (<span class="dt">RCState</span> s) <span class="fu">=</span> [<span class="fu">-</span>(min <span class="dv">5</span> (snd s)) <span class="fu">..</span> min <span class="dv">5</span> (fst s)]</a>
<a class="sourceLine" id="cb4-177" data-line-number="177"></a>
<a class="sourceLine" id="cb4-178" data-line-number="178"><span class="co">{----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-179" data-line-number="179"><span class="co">  main()</span></a>
<a class="sourceLine" id="cb4-180" data-line-number="180"><span class="co">----------------------------------------------------------------------}</span></a>
<a class="sourceLine" id="cb4-181" data-line-number="181"></a>
<a class="sourceLine" id="cb4-182" data-line-number="182"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb4-183" data-line-number="183">main <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb4-184" data-line-number="184">  <span class="co">-- Process command line options.</span></a>
<a class="sourceLine" id="cb4-185" data-line-number="185">  <span class="co">-- o :: Opts Unwrapped &lt;- unwrapRecord &quot;A simple Tic-Tac-Toe example using reinforcement learning.&quot;</span></a>
<a class="sourceLine" id="cb4-186" data-line-number="186">  <span class="co">-- let n   = fromMaybe 10  (number o)</span></a>
<a class="sourceLine" id="cb4-187" data-line-number="187">  <span class="co">--     r   = fromMaybe 0.1 (rate   o)</span></a>
<a class="sourceLine" id="cb4-188" data-line-number="188"></a>
<a class="sourceLine" id="cb4-189" data-line-number="189">  <span class="co">-- Plot the pdfs.</span></a>
<a class="sourceLine" id="cb4-190" data-line-number="190">  writeFile  <span class="st">&quot;other/rentalcars.md&quot;</span> <span class="st">&quot;### Return/Request Probability Distribution Functions\n\n&quot;</span></a>
<a class="sourceLine" id="cb4-191" data-line-number="191">  toFile def <span class="st">&quot;img/pdfs.png&quot;</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb4-192" data-line-number="192">    <span class="kw">do</span> layout_title <span class="fu">.=</span> <span class="st">&quot;Return/Request Probability Distribution Functions&quot;</span></a>
<a class="sourceLine" id="cb4-193" data-line-number="193">       setColors <span class="fu">$</span> map opaque [red, blue, green, yellow]</a>
<a class="sourceLine" id="cb4-194" data-line-number="194">       forM_ ( zip [<span class="st">&quot;Req1&quot;</span>, <span class="st">&quot;Req2&quot;</span>, <span class="st">&quot;Ret1&quot;</span>, <span class="st">&quot;Ret2&quot;</span>]</a>
<a class="sourceLine" id="cb4-195" data-line-number="195">                   [<span class="dv">3</span>,      <span class="dv">4</span>,      <span class="dv">3</span>,      <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb4-196" data-line-number="196">             ) <span class="fu">$</span> \ (lbl, n) <span class="ot">-&gt;</span> plot (line lbl [[(x, poisson n x) <span class="fu">|</span> x <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">20</span>]]])</a>
<a class="sourceLine" id="cb4-197" data-line-number="197">  appendFile <span class="st">&quot;other/rentalcars.md&quot;</span> <span class="st">&quot;![](img/pdfs.png)\n&quot;</span></a>
<a class="sourceLine" id="cb4-198" data-line-number="198"></a>
<a class="sourceLine" id="cb4-199" data-line-number="199">  <span class="co">-- Calculate and display optimum policy.</span></a>
<a class="sourceLine" id="cb4-200" data-line-number="200">  <span class="co">-- print $ optPol pdfGen eps&#39; gamma&#39; asOfS allStates</span></a>
<a class="sourceLine" id="cb4-201" data-line-number="201">  <span class="co">-- appendFile &quot;other/rentalcars.md&quot; &quot;\n### First 3 policies\n\n&quot;</span></a>
<a class="sourceLine" id="cb4-202" data-line-number="202">  <span class="co">-- forM_ (take 3 $ optPol pdfGen eps&#39; gamma&#39; asOfS allStates) $ \p -&gt;</span></a>
<a class="sourceLine" id="cb4-203" data-line-number="203">  <span class="co">--       appendFile &quot;other/rentalcars.md&quot; $ pack $ showPol p</span></a>
<a class="sourceLine" id="cb4-204" data-line-number="204">  <span class="co">-- forM_ (take 3 $ optPol 2 pdfGen eps&#39; gamma&#39; asOfS allStates)</span></a>
<a class="sourceLine" id="cb4-205" data-line-number="205">  <span class="co">--       $ appendFile &quot;other/rentalcars.md&quot; . pack . showPol</span></a>
<a class="sourceLine" id="cb4-206" data-line-number="206">  <span class="kw">let</span> (pols, vss) <span class="fu">=</span> optPol <span class="dv">1</span> pdfGen eps&#39; gamma&#39; asOfS allStates  <span class="co">-- :: ([s -&gt; a], [[((s -&gt; Float), Float)]])</span></a>
<a class="sourceLine" id="cb4-207" data-line-number="207">  appendFile <span class="st">&quot;other/rentalcars.md&quot;</span> <span class="st">&quot;\n### Last policy\n\n&quot;</span></a>
<a class="sourceLine" id="cb4-208" data-line-number="208">  <span class="co">-- appendFile &quot;other/rentalcars.md&quot; . pack . showPol $ P.head pols</span></a>
<a class="sourceLine" id="cb4-209" data-line-number="209">  appendFile <span class="st">&quot;other/rentalcars.md&quot;</span> <span class="fu">.</span> pack <span class="fu">.</span> showPol <span class="fu">$</span> pols <span class="fu">P.!!</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb4-210" data-line-number="210">  appendFile <span class="st">&quot;other/rentalcars.md&quot;</span> <span class="st">&quot;\n### Last policy&#39;s value function\n\n&quot;</span></a>
<a class="sourceLine" id="cb4-211" data-line-number="211">  forM_ (P.head vss) (appendFile <span class="st">&quot;other/rentalcars.md&quot;</span> <span class="fu">.</span> pack <span class="fu">.</span> showVal)</a>
<a class="sourceLine" id="cb4-212" data-line-number="212"></a>
<a class="sourceLine" id="cb4-213" data-line-number="213"><span class="co">{----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-214" data-line-number="214"><span class="co">  Misc.</span></a>
<a class="sourceLine" id="cb4-215" data-line-number="215"><span class="co">----------------------------------------------------------------------}</span></a>
<a class="sourceLine" id="cb4-216" data-line-number="216"></a>
<a class="sourceLine" id="cb4-217" data-line-number="217"><span class="ot">showPol ::</span> <span class="dt">Policy</span> <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb4-218" data-line-number="218">showPol pol <span class="fu">=</span> showFofState pol</a>
<a class="sourceLine" id="cb4-219" data-line-number="219"></a>
<a class="sourceLine" id="cb4-220" data-line-number="220"><span class="ot">showVal ::</span> ((<span class="dt">RCState</span> <span class="ot">-&gt;</span> <span class="dt">Float</span>), <span class="dt">Float</span>) <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb4-221" data-line-number="221">showVal (v, delta) <span class="fu">=</span> showFofState v <span class="fu">++</span> (printf <span class="st">&quot;$\\quad \\delta = %5.3f$&quot;</span> delta)</a>
<a class="sourceLine" id="cb4-222" data-line-number="222"></a>
<a class="sourceLine" id="cb4-223" data-line-number="223"><span class="ot">showFofState ::</span> (<span class="dt">Show</span> a) <span class="ot">=&gt;</span> (<span class="dt">RCState</span> <span class="ot">-&gt;</span> a) <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb4-224" data-line-number="224">showFofState g <span class="fu">=</span> unlines</a>
<a class="sourceLine" id="cb4-225" data-line-number="225">  ( <span class="st">&quot;\\begin{array}{c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c}&quot;</span> <span class="fu">:</span></a>
<a class="sourceLine" id="cb4-226" data-line-number="226">    intersperse <span class="st">&quot;\\hline&quot;</span></a>
<a class="sourceLine" id="cb4-227" data-line-number="227">      ( map ((<span class="fu">++</span> <span class="st">&quot; \\\\&quot;</span>) <span class="fu">.</span> intercalate <span class="st">&quot; &amp; &quot;</span> <span class="fu">.</span> map show)</a>
<a class="sourceLine" id="cb4-228" data-line-number="228">            [ [g (<span class="dt">RCState</span> (m,n)) <span class="fu">|</span> n <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">20</span>]] <span class="fu">|</span> m <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">20</span>]]</a>
<a class="sourceLine" id="cb4-229" data-line-number="229">      )</a>
<a class="sourceLine" id="cb4-230" data-line-number="230">    <span class="fu">++</span> [<span class="st">&quot;\\end{array}&quot;</span>]</a>
<a class="sourceLine" id="cb4-231" data-line-number="231">  )</a>
<a class="sourceLine" id="cb4-232" data-line-number="232"></a>
<a class="sourceLine" id="cb4-233" data-line-number="233"><span class="co">-- toBoth :: (a -&gt; b) -&gt; (a,a) -&gt; (b,b)</span></a>
<a class="sourceLine" id="cb4-234" data-line-number="234"><span class="co">-- toBoth f (x1, x2) = (f x1, f x2)</span></a>
<a class="sourceLine" id="cb4-235" data-line-number="235"></a>
<a class="sourceLine" id="cb4-236" data-line-number="236"><span class="co">-- for :: (Functor f) =&gt; f a -&gt; (a -&gt; b) -&gt; f b</span></a>
<a class="sourceLine" id="cb4-237" data-line-number="237"><span class="co">-- for = flip map</span></a>
<a class="sourceLine" id="cb4-238" data-line-number="238"></a>
<a class="sourceLine" id="cb4-239" data-line-number="239"><span class="ot">poisson ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="cb4-240" data-line-number="240"><span class="co">-- poisson lambda n = pow lambda n * exp (-lambda) / fact n</span></a>
<a class="sourceLine" id="cb4-241" data-line-number="241">poisson lambda n <span class="fu">=</span> lambda&#39; <span class="fu">^</span> n&#39; <span class="fu">*</span> exp (<span class="fu">-</span>lambda&#39;) <span class="fu">/</span> (fromIntegral <span class="fu">$</span> fact n)</a>
<a class="sourceLine" id="cb4-242" data-line-number="242"> <span class="kw">where</span> lambda&#39; <span class="fu">=</span> fromIntegral lambda</a>
<a class="sourceLine" id="cb4-243" data-line-number="243">       n&#39;      <span class="fu">=</span> fromIntegral n</a>
<a class="sourceLine" id="cb4-244" data-line-number="244"></a>
<a class="sourceLine" id="cb4-245" data-line-number="245"><span class="ot">fact ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb4-246" data-line-number="246">fact <span class="dv">0</span> <span class="fu">=</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb4-247" data-line-number="247">fact n <span class="fu">=</span> n <span class="fu">*</span> fact (n <span class="fu">-</span> <span class="dv">1</span>)</a></code></pre></div>
<h2 id="output">output</h2>
<h3 id="returnrequest-probability-distribution-functions">Return/Request Probability Distribution Functions</h3>
<figure>
<img src="img/pdfs.png" />
</figure>
<h3 id="last-policy">Last policy</h3>
<span class="math display">\[\begin{array}{c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c}
0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; -1 &amp; -2 &amp; -2 &amp; -3 &amp; -3 &amp; -3 &amp; -4 &amp; -4 &amp; -4 &amp; -4 &amp; -4 &amp; -4 &amp; -4 &amp; -4 &amp; -4 &amp; -4 \\
\hline
1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; -1 &amp; -2 &amp; -2 &amp; -2 &amp; -3 &amp; -3 &amp; -3 &amp; -3 &amp; -3 &amp; -3 &amp; -3 &amp; -3 &amp; -3 &amp; -3 &amp; -3 \\
\hline
2 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; -1 &amp; -1 &amp; -2 &amp; -2 &amp; -2 &amp; -2 &amp; -2 &amp; -2 &amp; -2 &amp; -2 &amp; -2 &amp; -2 &amp; -2 &amp; -2 \\
\hline
2 &amp; 2 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; -1 &amp; -1 &amp; -1 &amp; -1 &amp; -1 &amp; -2 &amp; -2 &amp; -2 &amp; -2 &amp; -2 &amp; -2 &amp; -2 \\
\hline
3 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; -1 &amp; -1 &amp; -1 &amp; -1 &amp; -1 &amp; -1 &amp; -1 &amp; -1 \\
\hline
3 &amp; 3 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
4 &amp; 3 &amp; 3 &amp; 2 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
4 &amp; 4 &amp; 3 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
5 &amp; 4 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
5 &amp; 5 &amp; 4 &amp; 3 &amp; 2 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
5 &amp; 5 &amp; 4 &amp; 3 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
5 &amp; 5 &amp; 4 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
5 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
5 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
5 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
5 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
5 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
5 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
5 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
5 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
5 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\end{array}\]</span>
<h3 id="last-policys-value-function">Last policy's value function</h3>
<span class="math display">\[\begin{array}{c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c}
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\hline
0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 &amp; 0.0 \\
\end{array}\]</span>
<p><span class="math inline">\(\quad \delta = 0.000\)</span></p>
<hr />
<div class="footer">
<p>Powered by <a href="https://haskell-lang.org/">haskell</a>, <a href="https://docs.haskellstack.org/en/stable/README/">stack</a> and <a href="http://pandoc.org/">pandoc</a>.</p>
</div>
