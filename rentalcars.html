<meta charset="utf-8"> <link rel="stylesheet" href="other/lhs.css">
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<h1 id="haskell-rl-rental-car-problem-ex.-4.7-from-sutton-bartow">haskell-rl : Rental Car Problem (Ex. 4.7 from Sutton &amp; Bartow)</h1>
<p>This <a href="https://wiki.haskell.org/Literate_programming">literate Haskell</a> document provides a solution to Exercise 4.7 in <em>Reinforcement Learning</em> by Sutton &amp; Barotw.</p>
<p>Original author: <a href="mailto:David.Banas@target.com">David Banas</a><br />
Original date: April 20, 2018</p>
<p>Copyright Â© 2018 Target Corp.; all rights reserved World wide.</p>
<h2 id="contents">Contents</h2>
<ul class="incremental">
<li><a href="#code">Code</a></li>
<li><a href="#output">Output</a></li>
</ul>
<h2 id="code">code</h2>
<h2 id="ghc-options"><a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/flags.html#flag-reference">ghc options</a></h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ot">{-# OPTIONS_GHC -Wall #-}</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="ot">{-# OPTIONS_GHC -fno-warn-type-defaults #-}</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="ot">{-# OPTIONS_GHC -Wno-missing-signatures #-}</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="ot">{-# OPTIONS_GHC -Wno-orphans #-}</span></a></code></pre></div>
<h2 id="pragmas"><a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/lang.html">pragmas</a></h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">-- doctest doesn&#39;t look at the cabal file, so you need pragmas here</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="ot">{-# LANGUAGE NoImplicitPrelude #-}</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="ot">{-# LANGUAGE DataKinds #-}</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="ot">{-# LANGUAGE DeriveGeneric #-}</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="ot">{-# LANGUAGE FlexibleContexts #-}</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="ot">{-# LANGUAGE ScopedTypeVariables #-}</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="ot">{-# LANGUAGE TypeOperators #-}</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="ot">{-# LANGUAGE TypeFamilies #-}</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="ot">{-# LANGUAGE FlexibleInstances #-}</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">-- {-# LANGUAGE BangPatterns #-}</span></a></code></pre></div>
<h2 id="libraries"><a href="https://www.stackage.org/">libraries</a></h2>
<ul class="incremental">
<li><a href="https://www.stackage.org/package/protolude">protolude</a></li>
<li><a href="https://www.stackage.org/package/optparse-generic">optparse-generic</a></li>
<li><a href="https://www.stackage.org/package/vector-sized">vector-sized</a></li>
<li><a href="https://www.stackage.org/package/finite-typelits">finite-typelits</a></li>
<li><a href="https://www.stackage.org/package/extra">extra</a></li>
<li><a href="https://www.stackage.org/package/finite-typelits">finite-typelits</a></li>
<li><a href="https://www.stackage.org/package/text">text</a></li>
<li><a href="https://www.stackage.org/package/random">random</a></li>
<li><a href="https://www.stackage.org/package/random-shuffle">random-shuffle</a></li>
<li><a href="https://www.stackage.org/package/Chart">Chart</a></li>
<li><a href="https://www.stackage.org/package/Chart-cairo">Chart-cairo</a></li>
<li><a href="https://hackage.haskell.org/package/MemoTrie">MemoTrie</a></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Prelude</span> <span class="kw">as</span> <span class="dt">P</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">import</span> <span class="dt">Prelude</span> (unlines, <span class="dt">Show</span>(..), <span class="dt">String</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="kw">import</span> <span class="dt">Protolude</span>  <span class="kw">hiding</span> (show, for)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="kw">import</span> <span class="dt">Options.Generic</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="kw">import</span> <span class="dt">GHC.TypeNats</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="kw">import</span> <span class="dt">Control.Monad.Writer</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Vector.Sized</span>   <span class="kw">as</span> <span class="dt">VS</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="kw">import</span> <span class="dt">Data.Finite</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="kw">import</span> <span class="dt">Data.Finite.Internal</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="kw">import</span> <span class="dt">Data.List</span>                            ((!!))</a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="kw">import</span> <span class="dt">Data.MemoTrie</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="kw">import</span> <span class="dt">Data.Text</span>                            (pack)</a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="kw">import</span> <span class="dt">Graphics.Rendering.Chart.Easy</span> <span class="kw">hiding</span> (<span class="dt">Wrapped</span>, <span class="dt">Unwrapped</span>, <span class="dt">Empty</span>)</a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="kw">import</span> <span class="dt">Graphics.Rendering.Chart.Backend.Cairo</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="kw">import</span> <span class="dt">Text.Printf</span></a></code></pre></div>
<h2 id="code-1">code</h2>
<ul class="incremental">
<li><a href="https://www.stackage.org/package/hoogle">hoogle</a></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">{----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">  Orphans</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">----------------------------------------------------------------------}</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw">instance</span> (<span class="dt">KnownNat</span> n) <span class="ot">=&gt;</span> <span class="dt">HasTrie</span> (<span class="dt">Finite</span> n) <span class="kw">where</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="kw">data</span> <span class="dt">Finite</span> n <span class="fu">:-&gt;:</span> x     <span class="fu">=</span> <span class="dt">FiniteTrie</span> (<span class="dt">VS.Vector</span> n x)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">  trie f                   <span class="fu">=</span> <span class="dt">FiniteTrie</span> (VS.generate (f <span class="fu">.</span> finite <span class="fu">.</span> fromIntegral))</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">  untrie (<span class="dt">FiniteTrie</span> v)    <span class="fu">=</span> VS.index v</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">  enumerate (<span class="dt">FiniteTrie</span> v) <span class="fu">=</span> map (first (finite <span class="fu">.</span> fromIntegral)) <span class="fu">$</span> (VS.toList <span class="fu">.</span> VS.indexed) v</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">{----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">  General policy iterator</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">----------------------------------------------------------------------}</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">-- | Yields a single policy improvment iteration, given:</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">--   - gamma           - discount rate</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">--   - eps             - convergence tolerance</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">--   - n               - max. policy evaluation iterations</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">--   - S               - set of all possible system states</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">--   - A(s)            - all possible actions in state s,</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">--   - S&#39;(s, a)        - all possible next states, for a given state/action pair, and</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co">--   - R(s, a, s&#39;)     - all possible rewards for a given state/action/next-state triple,</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="co">--                       along with their probabilities of occurence.</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">--</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="co">-- Returns a combined policy &amp; value function.</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="ot">optPol ::</span> ( <span class="dt">HasTrie</span> s</a>
<a class="sourceLine" id="cb4-26" data-line-number="26">          , <span class="dt">HasTrie</span> a, <span class="dt">Num</span> a  <span class="co">-- &quot;Num a&quot; is TEMPORARY; See TODO above.</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27">          , <span class="dt">KnownNat</span> (n <span class="fu">+</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-28" data-line-number="28">          )</a>
<a class="sourceLine" id="cb4-29" data-line-number="29">       <span class="ot">=&gt;</span> <span class="dt">Float</span>                              <span class="co">-- ^ discount rate</span></a>
<a class="sourceLine" id="cb4-30" data-line-number="30">       <span class="ot">-&gt;</span> <span class="dt">Float</span>                              <span class="co">-- ^ evaluation convergence tolerance</span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31">       <span class="ot">-&gt;</span> <span class="dt">Int</span>                                <span class="co">-- ^ max. # of evaluation iterations per improvement iteration</span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32">       <span class="ot">-&gt;</span> <span class="dt">VS.Vector</span> (n <span class="fu">+</span> <span class="dv">1</span>) s                <span class="co">-- ^ vector of all possible system states</span></a>
<a class="sourceLine" id="cb4-33" data-line-number="33">       <span class="ot">-&gt;</span> (s <span class="ot">-&gt;</span> [a])                         <span class="co">-- ^ A(s)</span></a>
<a class="sourceLine" id="cb4-34" data-line-number="34">       <span class="ot">-&gt;</span> (s <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [s])                    <span class="co">-- ^ S&#39;(s, a)</span></a>
<a class="sourceLine" id="cb4-35" data-line-number="35">       <span class="ot">-&gt;</span> (s <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> s <span class="ot">-&gt;</span> [(<span class="dt">Float</span>, <span class="dt">Float</span>)])  <span class="co">-- ^ R(s, a, s&#39;)</span></a>
<a class="sourceLine" id="cb4-36" data-line-number="36">       <span class="ot">-&gt;</span> ((s <span class="ot">-&gt;</span> (a, <span class="dt">Float</span>)), <span class="dt">String</span>)        <span class="co">-- ^ initial (combined) policy &amp; value function</span></a>
<a class="sourceLine" id="cb4-37" data-line-number="37">       <span class="ot">-&gt;</span> ((s <span class="ot">-&gt;</span> (a, <span class="dt">Float</span>)), <span class="dt">String</span>)</a>
<a class="sourceLine" id="cb4-38" data-line-number="38">optPol gamma eps n ss as s&#39;s rs (g, _) <span class="fu">=</span> (bestA, msg)</a>
<a class="sourceLine" id="cb4-39" data-line-number="39"> <span class="kw">where</span></a>
<a class="sourceLine" id="cb4-40" data-line-number="40">  bestA   <span class="fu">=</span> maximumBy (compare <span class="ot">`on`</span> snd) <span class="fu">.</span> aVals v&#39;</a>
<a class="sourceLine" id="cb4-41" data-line-number="41">  aVals v <span class="fu">=</span> \s <span class="ot">-&gt;</span> <span class="kw">let</span> actVal&#39;&#39; <span class="fu">=</span> actVal&#39; v</a>
<a class="sourceLine" id="cb4-42" data-line-number="42">                   <span class="kw">in</span> [ (a, actVal&#39;&#39; (s, a))</a>
<a class="sourceLine" id="cb4-43" data-line-number="43">                      <span class="fu">|</span> a <span class="ot">&lt;-</span> as s</a>
<a class="sourceLine" id="cb4-44" data-line-number="44">                      ]</a>
<a class="sourceLine" id="cb4-45" data-line-number="45">  actVal&#39; <span class="fu">=</span> memo <span class="fu">.</span> uncurry <span class="fu">.</span> actVal</a>
<a class="sourceLine" id="cb4-46" data-line-number="46">  actVal v s a <span class="fu">=</span></a>
<a class="sourceLine" id="cb4-47" data-line-number="47">    sum [ pt <span class="fu">*</span> gamma <span class="fu">*</span> u <span class="fu">+</span> rt</a>
<a class="sourceLine" id="cb4-48" data-line-number="48">        <span class="fu">|</span> s&#39; <span class="ot">&lt;-</span> s&#39;s s a</a>
<a class="sourceLine" id="cb4-49" data-line-number="49">        , <span class="kw">let</span> u <span class="fu">=</span> v s&#39;</a>
<a class="sourceLine" id="cb4-50" data-line-number="50">        , <span class="kw">let</span> (pt, rt) <span class="fu">=</span> foldl prSum (<span class="dv">0</span>,<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb4-51" data-line-number="51">                               [ (p, p <span class="fu">*</span> r)</a>
<a class="sourceLine" id="cb4-52" data-line-number="52">                               <span class="fu">|</span> (r, p) <span class="ot">&lt;-</span> rs&#39; s a s&#39;</a>
<a class="sourceLine" id="cb4-53" data-line-number="53">                               ]</a>
<a class="sourceLine" id="cb4-54" data-line-number="54">        ]</a>
<a class="sourceLine" id="cb4-55" data-line-number="55">  prSum (x1,y1) (x2,y2) <span class="fu">=</span> (x1<span class="fu">+</span>x2,y1<span class="fu">+</span>y2)</a>
<a class="sourceLine" id="cb4-56" data-line-number="56">  rs&#39; <span class="fu">=</span> memo3 rs</a>
<a class="sourceLine" id="cb4-57" data-line-number="57">  ((_, v&#39;), msg) <span class="fu">=</span></a>
<a class="sourceLine" id="cb4-58" data-line-number="58">    first (fromMaybe (P.error <span class="st">&quot;Major blow-up!&quot;</span>))</a>
<a class="sourceLine" id="cb4-59" data-line-number="59">      <span class="fu">$</span> runWriter</a>
<a class="sourceLine" id="cb4-60" data-line-number="60">        <span class="fu">$</span> withinOnM</a>
<a class="sourceLine" id="cb4-61" data-line-number="61">            eps</a>
<a class="sourceLine" id="cb4-62" data-line-number="62">            (chooseAndCount max (<span class="fu">&gt;</span> eps) <span class="st">&quot;- Found %3d state value diffs &gt; eps.  \n&quot;</span> <span class="fu">.</span> fst)</a>
<a class="sourceLine" id="cb4-63" data-line-number="63">            <span class="fu">$</span> zip (map abs <span class="fu">$</span> zipWith (<span class="fu">-</span>) vs (P.tail vs))</a>
<a class="sourceLine" id="cb4-64" data-line-number="64">                  (P.tail evalIters)</a>
<a class="sourceLine" id="cb4-65" data-line-number="65">  vs <span class="fu">=</span> map (vsFor ss) evalIters</a>
<a class="sourceLine" id="cb4-66" data-line-number="66">  evalIters <span class="fu">=</span> take (n <span class="fu">+</span> <span class="dv">1</span>) <span class="fu">$</span> iterate (evalPol (fst <span class="fu">.</span> g)) <span class="fu">$</span> snd <span class="fu">.</span> g</a>
<a class="sourceLine" id="cb4-67" data-line-number="67">  evalPol p v <span class="fu">=</span> <span class="kw">let</span> actVal&#39;&#39; <span class="fu">=</span> actVal&#39; v</a>
<a class="sourceLine" id="cb4-68" data-line-number="68">                 <span class="kw">in</span> \s <span class="ot">-&gt;</span> actVal&#39;&#39; (s, p s)</a>
<a class="sourceLine" id="cb4-69" data-line-number="69"></a>
<a class="sourceLine" id="cb4-70" data-line-number="70"><span class="co">{----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-71" data-line-number="71"><span class="co">  Problem specific definitions</span></a>
<a class="sourceLine" id="cb4-72" data-line-number="72"><span class="co">----------------------------------------------------------------------}</span></a>
<a class="sourceLine" id="cb4-73" data-line-number="73"></a>
<a class="sourceLine" id="cb4-74" data-line-number="74">eps&#39;   <span class="fu">=</span> <span class="fl">0.1</span>  <span class="co">-- my choice</span></a>
<a class="sourceLine" id="cb4-75" data-line-number="75">gamma&#39; <span class="fu">=</span> <span class="fl">0.9</span>  <span class="co">-- dictated by Exercise 4.7.</span></a>
<a class="sourceLine" id="cb4-76" data-line-number="76"></a>
<a class="sourceLine" id="cb4-77" data-line-number="77"><span class="co">-- expectations for Poisson distributions</span></a>
<a class="sourceLine" id="cb4-78" data-line-number="78">gEXPREQ1 <span class="fu">=</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb4-79" data-line-number="79">gEXPREQ2 <span class="fu">=</span> <span class="dv">4</span></a>
<a class="sourceLine" id="cb4-80" data-line-number="80">gEXPRET1 <span class="fu">=</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb4-81" data-line-number="81">gEXPRET2 <span class="fu">=</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb4-82" data-line-number="82"></a>
<a class="sourceLine" id="cb4-83" data-line-number="83">pReq1  <span class="fu">=</span> poisson&#39; <span class="fu">$</span> finite gEXPREQ1</a>
<a class="sourceLine" id="cb4-84" data-line-number="84">pReq2  <span class="fu">=</span> poisson&#39; <span class="fu">$</span> finite gEXPREQ2</a>
<a class="sourceLine" id="cb4-85" data-line-number="85"><span class="co">-- pRet1  = poisson&#39; $ finite gEXPRET1</span></a>
<a class="sourceLine" id="cb4-86" data-line-number="86"><span class="co">-- pRet2  = poisson&#39; $ finite gEXPRET2</span></a>
<a class="sourceLine" id="cb4-87" data-line-number="87"></a>
<a class="sourceLine" id="cb4-88" data-line-number="88"><span class="kw">type</span> <span class="dt">RCState</span>  <span class="fu">=</span> (<span class="dt">Finite</span> <span class="dv">21</span>, <span class="dt">Finite</span> <span class="dv">21</span>)  <span class="co">-- ^ # of cars at locations 1 and 2.</span></a>
<a class="sourceLine" id="cb4-89" data-line-number="89"><span class="kw">type</span> <span class="dt">RCAction</span> <span class="fu">=</span> <span class="dt">Int</span>                     <span class="co">-- ^ # of cars to move from 1 to 2</span></a>
<a class="sourceLine" id="cb4-90" data-line-number="90"></a>
<a class="sourceLine" id="cb4-91" data-line-number="91"><span class="co">-- | S</span></a>
<a class="sourceLine" id="cb4-92" data-line-number="92"><span class="ot">allStates ::</span> [<span class="dt">RCState</span>]</a>
<a class="sourceLine" id="cb4-93" data-line-number="93">allStates <span class="fu">=</span> [(finite m, finite n) <span class="fu">|</span> m <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">20</span>], n <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">20</span>]]</a>
<a class="sourceLine" id="cb4-94" data-line-number="94"></a>
<a class="sourceLine" id="cb4-95" data-line-number="95"><span class="co">-- Just a sized vector alternative to the list above.</span></a>
<a class="sourceLine" id="cb4-96" data-line-number="96"><span class="ot">allStatesV ::</span> <span class="dt">VS.Vector</span> <span class="dv">441</span> (<span class="dt">Finite</span> <span class="dv">21</span>, <span class="dt">Finite</span> <span class="dv">21</span>)</a>
<a class="sourceLine" id="cb4-97" data-line-number="97">allStatesV <span class="fu">=</span> fromMaybe (VS.replicate (finite <span class="dv">0</span>, finite <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb4-98" data-line-number="98">                       <span class="fu">$</span> VS.fromList allStates</a>
<a class="sourceLine" id="cb4-99" data-line-number="99"></a>
<a class="sourceLine" id="cb4-100" data-line-number="100"><span class="co">-- | A(s)</span></a>
<a class="sourceLine" id="cb4-101" data-line-number="101"><span class="ot">actions ::</span> <span class="dt">RCState</span> <span class="ot">-&gt;</span> [<span class="dt">RCAction</span>]</a>
<a class="sourceLine" id="cb4-102" data-line-number="102">actions (<span class="dt">Finite</span> n1, <span class="dt">Finite</span> n2) <span class="fu">=</span> map fromIntegral [<span class="fu">-</span>(min <span class="dv">5</span> n2) <span class="fu">..</span> min <span class="dv">5</span> n1]</a>
<a class="sourceLine" id="cb4-103" data-line-number="103"></a>
<a class="sourceLine" id="cb4-104" data-line-number="104"><span class="co">-- | S&#39;(s, a)</span></a>
<a class="sourceLine" id="cb4-105" data-line-number="105"><span class="ot">nextStates ::</span> <span class="dt">RCState</span> <span class="ot">-&gt;</span> <span class="dt">RCAction</span> <span class="ot">-&gt;</span> [<span class="dt">RCState</span>]</a>
<a class="sourceLine" id="cb4-106" data-line-number="106">nextStates (<span class="dt">Finite</span> n1, <span class="dt">Finite</span> n2) a <span class="fu">=</span></a>
<a class="sourceLine" id="cb4-107" data-line-number="107">  [ (finite m1, finite m2)</a>
<a class="sourceLine" id="cb4-108" data-line-number="108">  <span class="fu">|</span> m1 <span class="ot">&lt;-</span> [max <span class="dv">0</span> (min <span class="dv">20</span> (n1 <span class="fu">-</span> a&#39;) <span class="fu">-</span> <span class="dv">11</span>) <span class="fu">..</span> min <span class="dv">20</span> (min <span class="dv">20</span> (n1 <span class="fu">-</span> a&#39;) <span class="fu">+</span> <span class="dv">11</span>)]</a>
<a class="sourceLine" id="cb4-109" data-line-number="109">  , m2 <span class="ot">&lt;-</span> [max <span class="dv">0</span> (min <span class="dv">20</span> (n2 <span class="fu">+</span> a&#39;) <span class="fu">-</span> <span class="dv">11</span>) <span class="fu">..</span> min <span class="dv">20</span> (min <span class="dv">20</span> (n2 <span class="fu">+</span> a&#39;) <span class="fu">+</span> <span class="dv">11</span>)]</a>
<a class="sourceLine" id="cb4-110" data-line-number="110">  ]</a>
<a class="sourceLine" id="cb4-111" data-line-number="111"> <span class="kw">where</span> a&#39; <span class="fu">=</span> fromIntegral a</a>
<a class="sourceLine" id="cb4-112" data-line-number="112"></a>
<a class="sourceLine" id="cb4-113" data-line-number="113"><span class="co">-- | R(s, a, s&#39;)</span></a>
<a class="sourceLine" id="cb4-114" data-line-number="114"><span class="co">--</span></a>
<a class="sourceLine" id="cb4-115" data-line-number="115"><span class="co">-- Returns a list of pairs, each containing:</span></a>
<a class="sourceLine" id="cb4-116" data-line-number="116"><span class="co">-- - a unique reward value, and</span></a>
<a class="sourceLine" id="cb4-117" data-line-number="117"><span class="co">-- - the probability of occurence for that value.</span></a>
<a class="sourceLine" id="cb4-118" data-line-number="118"><span class="ot">rewards ::</span> <span class="dt">RCState</span> <span class="ot">-&gt;</span> <span class="dt">RCAction</span> <span class="ot">-&gt;</span> <span class="dt">RCState</span> <span class="ot">-&gt;</span> [(<span class="dt">Float</span>, <span class="dt">Float</span>)]</a>
<a class="sourceLine" id="cb4-119" data-line-number="119">rewards (<span class="dt">Finite</span> n1, <span class="dt">Finite</span> n2) a (<span class="dt">Finite</span> n1&#39;, <span class="dt">Finite</span> n2&#39;) <span class="fu">=</span></a>
<a class="sourceLine" id="cb4-120" data-line-number="120">  [ ( fromIntegral (<span class="dv">10</span> <span class="fu">*</span> (nReq1&#39; <span class="fu">+</span> nReq2&#39;) <span class="fu">-</span> <span class="dv">2</span> <span class="fu">*</span> abs a&#39;)</a>
<a class="sourceLine" id="cb4-121" data-line-number="121">    , product <span class="fu">$</span></a>
<a class="sourceLine" id="cb4-122" data-line-number="122">        zipWith (<span class="fu">$</span>) [ pReq1, pReq2 ]</a>
<a class="sourceLine" id="cb4-123" data-line-number="123">                    [ (finite <span class="fu">.</span> fromIntegral) nReq1</a>
<a class="sourceLine" id="cb4-124" data-line-number="124">                    , (finite <span class="fu">.</span> fromIntegral) nReq2</a>
<a class="sourceLine" id="cb4-125" data-line-number="125">                    ]</a>
<a class="sourceLine" id="cb4-126" data-line-number="126">    )</a>
<a class="sourceLine" id="cb4-127" data-line-number="127">  <span class="fu">|</span> nReq1 <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">11</span>]</a>
<a class="sourceLine" id="cb4-128" data-line-number="128">  , nReq2 <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">11</span>]</a>
<a class="sourceLine" id="cb4-129" data-line-number="129">  , <span class="kw">let</span> m1     <span class="fu">=</span> min <span class="dv">20</span> (n1 <span class="fu">-</span> a&#39;)   <span class="co">-- # on lot in the morning</span></a>
<a class="sourceLine" id="cb4-130" data-line-number="130">        m2     <span class="fu">=</span> min <span class="dv">20</span> (n2 <span class="fu">+</span> a&#39;)</a>
<a class="sourceLine" id="cb4-131" data-line-number="131">        nReq1&#39; <span class="fu">=</span> min nReq1 m1       <span class="co">-- # actually rented</span></a>
<a class="sourceLine" id="cb4-132" data-line-number="132">        nReq2&#39; <span class="fu">=</span> min nReq2 m2</a>
<a class="sourceLine" id="cb4-133" data-line-number="133">  <span class="co">-- Copying the same &quot;cheat&quot; used in the Python code.</span></a>
<a class="sourceLine" id="cb4-134" data-line-number="134">  <span class="co">-- (i.e. - # of cars returned assumed to equal expectaion.)</span></a>
<a class="sourceLine" id="cb4-135" data-line-number="135">  , <span class="kw">if</span> n1&#39; <span class="fu">==</span> <span class="dv">20</span> <span class="kw">then</span> gEXPRET1 <span class="fu">&gt;=</span> (n1&#39; <span class="fu">+</span> nReq1&#39; <span class="fu">-</span> m1)</a>
<a class="sourceLine" id="cb4-136" data-line-number="136">                   <span class="fu">&amp;&amp;</span> gEXPRET1 <span class="fu">&lt;=</span> <span class="dv">11</span></a>
<a class="sourceLine" id="cb4-137" data-line-number="137">                 <span class="kw">else</span> gEXPRET1 <span class="fu">==</span> n1&#39; <span class="fu">+</span> nReq1&#39; <span class="fu">-</span> m1</a>
<a class="sourceLine" id="cb4-138" data-line-number="138">  , <span class="kw">if</span> n2&#39; <span class="fu">==</span> <span class="dv">20</span> <span class="kw">then</span> gEXPRET2 <span class="fu">&gt;=</span> (n2&#39; <span class="fu">+</span> nReq2&#39; <span class="fu">-</span> m2)</a>
<a class="sourceLine" id="cb4-139" data-line-number="139">                   <span class="fu">&amp;&amp;</span> gEXPRET2 <span class="fu">&lt;=</span> <span class="dv">11</span></a>
<a class="sourceLine" id="cb4-140" data-line-number="140">                 <span class="kw">else</span> gEXPRET2 <span class="fu">==</span> n2&#39; <span class="fu">+</span> nReq2&#39; <span class="fu">-</span> m2</a>
<a class="sourceLine" id="cb4-141" data-line-number="141">  ]</a>
<a class="sourceLine" id="cb4-142" data-line-number="142"> <span class="kw">where</span> a&#39; <span class="fu">=</span> fromIntegral a</a>
<a class="sourceLine" id="cb4-143" data-line-number="143"></a>
<a class="sourceLine" id="cb4-144" data-line-number="144"><span class="co">{----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-145" data-line-number="145"><span class="co">  Command line options defintions.</span></a>
<a class="sourceLine" id="cb4-146" data-line-number="146"><span class="co">----------------------------------------------------------------------}</span></a>
<a class="sourceLine" id="cb4-147" data-line-number="147"></a>
<a class="sourceLine" id="cb4-148" data-line-number="148"><span class="kw">data</span> <span class="dt">Opts</span> w <span class="fu">=</span> <span class="dt">Opts</span></a>
<a class="sourceLine" id="cb4-149" data-line-number="149">    {<span class="ot"> nIter ::</span> w <span class="ot">::</span><span class="fu">:</span> <span class="dt">Maybe</span> <span class="dt">Int</span> <span class="fu">&lt;?&gt;</span> <span class="st">&quot;The number of policy improvement iterations&quot;</span></a>
<a class="sourceLine" id="cb4-150" data-line-number="150">    ,<span class="ot"> nEval ::</span> w <span class="ot">::</span><span class="fu">:</span> <span class="dt">Maybe</span> <span class="dt">Int</span> <span class="fu">&lt;?&gt;</span> <span class="st">&quot;The number of policy evaluation iterations per policy improvement iteration&quot;</span></a>
<a class="sourceLine" id="cb4-151" data-line-number="151">    }</a>
<a class="sourceLine" id="cb4-152" data-line-number="152">    <span class="kw">deriving</span> (<span class="dt">Generic</span>)</a>
<a class="sourceLine" id="cb4-153" data-line-number="153"></a>
<a class="sourceLine" id="cb4-154" data-line-number="154"><span class="kw">instance</span> <span class="dt">ParseRecord</span> (<span class="dt">Opts</span> <span class="dt">Wrapped</span>)</a>
<a class="sourceLine" id="cb4-155" data-line-number="155"></a>
<a class="sourceLine" id="cb4-156" data-line-number="156"></a>
<a class="sourceLine" id="cb4-157" data-line-number="157"><span class="co">{----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-158" data-line-number="158"><span class="co">  main()</span></a>
<a class="sourceLine" id="cb4-159" data-line-number="159"><span class="co">----------------------------------------------------------------------}</span></a>
<a class="sourceLine" id="cb4-160" data-line-number="160"></a>
<a class="sourceLine" id="cb4-161" data-line-number="161"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb4-162" data-line-number="162">main <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb4-163" data-line-number="163">  <span class="co">-- Process command line options.</span></a>
<a class="sourceLine" id="cb4-164" data-line-number="164"><span class="ot">  o ::</span> <span class="dt">Opts</span> <span class="dt">Unwrapped</span> <span class="ot">&lt;-</span> unwrapRecord <span class="st">&quot;A solution to the &#39;Jack&#39;s Rental Cars&#39; problem (Ex. 4.7).&quot;</span></a>
<a class="sourceLine" id="cb4-165" data-line-number="165">  <span class="kw">let</span> nIters <span class="fu">=</span> fromMaybe <span class="dv">2</span> (nIter o)</a>
<a class="sourceLine" id="cb4-166" data-line-number="166">      nEvals <span class="fu">=</span> fromMaybe <span class="dv">1</span> (nEval o)</a>
<a class="sourceLine" id="cb4-167" data-line-number="167"></a>
<a class="sourceLine" id="cb4-168" data-line-number="168">  <span class="co">-- Plot the pdfs.</span></a>
<a class="sourceLine" id="cb4-169" data-line-number="169">  writeFile  <span class="st">&quot;other/rentalcars.md&quot;</span> <span class="st">&quot;### Return/Request Probability Distribution Functions\n\n&quot;</span></a>
<a class="sourceLine" id="cb4-170" data-line-number="170">  toFile def <span class="st">&quot;img/pdfs.png&quot;</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb4-171" data-line-number="171">    <span class="kw">do</span> layout_title <span class="fu">.=</span> <span class="st">&quot;Return/Request Probability Distribution Functions&quot;</span></a>
<a class="sourceLine" id="cb4-172" data-line-number="172">       setColors <span class="fu">$</span> map opaque [red, blue, green, yellow]</a>
<a class="sourceLine" id="cb4-173" data-line-number="173">       forM_ ( zip [<span class="st">&quot;Req1&quot;</span>, <span class="st">&quot;Req2&quot;</span>, <span class="st">&quot;Ret1&quot;</span>, <span class="st">&quot;Ret2&quot;</span>]</a>
<a class="sourceLine" id="cb4-174" data-line-number="174">                   [<span class="dv">3</span>,      <span class="dv">4</span>,      <span class="dv">3</span>,      <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb4-175" data-line-number="175">             ) <span class="fu">$</span> \ (lbl, n) <span class="ot">-&gt;</span> plot (line lbl [[(x, poisson&#39; (finite n) (finite x)) <span class="fu">|</span> x <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">20</span>]]])</a>
<a class="sourceLine" id="cb4-176" data-line-number="176">  appendFile <span class="st">&quot;other/rentalcars.md&quot;</span> <span class="st">&quot;![](img/pdfs.png)\n&quot;</span></a>
<a class="sourceLine" id="cb4-177" data-line-number="177"></a>
<a class="sourceLine" id="cb4-178" data-line-number="178">  <span class="co">-- Calculate and display optimum policy.</span></a>
<a class="sourceLine" id="cb4-179" data-line-number="179">  appendFile <span class="st">&quot;other/rentalcars.md&quot;</span> <span class="st">&quot;\n### Policy optimization\n\n&quot;</span></a>
<a class="sourceLine" id="cb4-180" data-line-number="180">  <span class="kw">let</span> iters <span class="fu">=</span> take (nIters <span class="fu">+</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-181" data-line-number="181">                   <span class="fu">$</span> iterate (optPol gamma&#39; eps&#39; nEvals allStatesV actions nextStates rewards)</a>
<a class="sourceLine" id="cb4-182" data-line-number="182">                             (const (<span class="dv">0</span>,<span class="dv">0</span>), <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb4-183" data-line-number="183">      acts  <span class="fu">=</span> map ((\f <span class="ot">-&gt;</span> VS.map (fst <span class="fu">.</span> f) allStatesV) <span class="fu">.</span> fst) iters</a>
<a class="sourceLine" id="cb4-184" data-line-number="184">      diffs <span class="fu">=</span> map (VS.map (fromIntegral <span class="fu">.</span> abs) <span class="fu">.</span> uncurry (<span class="fu">-</span>))</a>
<a class="sourceLine" id="cb4-185" data-line-number="185">                  <span class="fu">$</span> zip acts (P.tail acts)</a>
<a class="sourceLine" id="cb4-186" data-line-number="186">  <span class="kw">let</span> ((_, (g&#39;, _)), msg) <span class="fu">=</span> first (fromMaybe (P.error <span class="st">&quot;main: Major failure!&quot;</span>)) <span class="fu">$</span></a>
<a class="sourceLine" id="cb4-187" data-line-number="187">        runWriter <span class="fu">$</span> withinOnM eps&#39;</a>
<a class="sourceLine" id="cb4-188" data-line-number="188">                              ( \ (dv, (_, msg&#39;)) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-189" data-line-number="189">                                  <span class="kw">do</span> tell msg&#39;</a>
<a class="sourceLine" id="cb4-190" data-line-number="190">                                     maxAndNonZero <span class="st">&quot;\n**Found %3d policy changes.**\n\n&quot;</span> dv</a>
<a class="sourceLine" id="cb4-191" data-line-number="191">                              ) <span class="fu">$</span> zip diffs (P.tail iters)</a>
<a class="sourceLine" id="cb4-192" data-line-number="192">  appendFile <span class="st">&quot;other/rentalcars.md&quot;</span> <span class="fu">$</span> pack msg</a>
<a class="sourceLine" id="cb4-193" data-line-number="193"></a>
<a class="sourceLine" id="cb4-194" data-line-number="194">  <span class="kw">let</span> pol   <span class="fu">=</span> fst <span class="fu">.</span> g&#39;</a>
<a class="sourceLine" id="cb4-195" data-line-number="195">      val   <span class="fu">=</span> snd <span class="fu">.</span> g&#39;</a>
<a class="sourceLine" id="cb4-196" data-line-number="196">  appendFile <span class="st">&quot;other/rentalcars.md&quot;</span> <span class="st">&quot;\n### Final policy\n\n&quot;</span></a>
<a class="sourceLine" id="cb4-197" data-line-number="197">  appendFile <span class="st">&quot;other/rentalcars.md&quot;</span> <span class="fu">$</span> pack <span class="fu">$</span> showFofState pol</a>
<a class="sourceLine" id="cb4-198" data-line-number="198">  appendFile <span class="st">&quot;other/rentalcars.md&quot;</span> <span class="st">&quot;\n### Final value function\n\n&quot;</span></a>
<a class="sourceLine" id="cb4-199" data-line-number="199">  appendFile <span class="st">&quot;other/rentalcars.md&quot;</span> <span class="fu">$</span> pack <span class="fu">$</span> showFofState (<span class="dt">Pfloat</span> <span class="fu">.</span> val)</a>
<a class="sourceLine" id="cb4-200" data-line-number="200">  <span class="co">-- appendFile &quot;other/rentalcars.md&quot; &quot;\n### E[reward]\n\n&quot;</span></a>
<a class="sourceLine" id="cb4-201" data-line-number="201">  <span class="co">-- appendFile &quot;other/rentalcars.md&quot; $ pack $ showFofState (Pfloat . testRewards)</span></a>
<a class="sourceLine" id="cb4-202" data-line-number="202"></a>
<a class="sourceLine" id="cb4-203" data-line-number="203"><span class="co">{----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb4-204" data-line-number="204"><span class="co">  Misc.</span></a>
<a class="sourceLine" id="cb4-205" data-line-number="205"><span class="co">----------------------------------------------------------------------}</span></a>
<a class="sourceLine" id="cb4-206" data-line-number="206"></a>
<a class="sourceLine" id="cb4-207" data-line-number="207"><span class="co">-- | Return the maximum value of a set, as well as a scripted log</span></a>
<a class="sourceLine" id="cb4-208" data-line-number="208"><span class="co">-- message, regarding the number of non-zero elements in the set.</span></a>
<a class="sourceLine" id="cb4-209" data-line-number="209"><span class="co">--</span></a>
<a class="sourceLine" id="cb4-210" data-line-number="210"><span class="co">-- (See documentation for `chooseAndCount` function.)</span></a>
<a class="sourceLine" id="cb4-211" data-line-number="211"><span class="ot">maxAndNonZero ::</span> (<span class="dt">Foldable</span> t, <span class="dt">Num</span> a, <span class="dt">Ord</span> a) <span class="ot">=&gt;</span> <span class="dt">String</span> <span class="ot">-&gt;</span> t a <span class="ot">-&gt;</span> <span class="dt">Writer</span> <span class="dt">String</span> a</a>
<a class="sourceLine" id="cb4-212" data-line-number="212">maxAndNonZero <span class="fu">=</span> chooseAndCount max (<span class="fu">/=</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb4-213" data-line-number="213"></a>
<a class="sourceLine" id="cb4-214" data-line-number="214"><span class="co">-- | Choose a value from the set using the given comparison function,</span></a>
<a class="sourceLine" id="cb4-215" data-line-number="215"><span class="co">-- and provide a scripted log message, regarding the number of elements</span></a>
<a class="sourceLine" id="cb4-216" data-line-number="216"><span class="co">-- in the set meeting the given criteria.</span></a>
<a class="sourceLine" id="cb4-217" data-line-number="217"><span class="ot">chooseAndCount ::</span> (<span class="dt">Foldable</span> t, <span class="dt">Num</span> a)</a>
<a class="sourceLine" id="cb4-218" data-line-number="218">               <span class="ot">=&gt;</span> (a <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> a)  <span class="co">-- ^ choice function</span></a>
<a class="sourceLine" id="cb4-219" data-line-number="219">               <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> <span class="dt">Bool</span>)    <span class="co">-- ^ counting predicate</span></a>
<a class="sourceLine" id="cb4-220" data-line-number="220">               <span class="ot">-&gt;</span> <span class="dt">String</span>         <span class="co">-- ^ message script (Should contain precisely 1 &quot;%d&quot;.)</span></a>
<a class="sourceLine" id="cb4-221" data-line-number="221">               <span class="ot">-&gt;</span> t a            <span class="co">-- ^ foldable set of elements to count/compare</span></a>
<a class="sourceLine" id="cb4-222" data-line-number="222">               <span class="ot">-&gt;</span> <span class="dt">Writer</span> <span class="dt">String</span> a</a>
<a class="sourceLine" id="cb4-223" data-line-number="223">chooseAndCount f p s xs <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb4-224" data-line-number="224">  <span class="kw">let</span> (val,<span class="ot"> cnt::</span><span class="dt">Int</span>) <span class="fu">=</span></a>
<a class="sourceLine" id="cb4-225" data-line-number="225">        foldl&#39; ( \ (v, c) x <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-226" data-line-number="226">                   ( f v x</a>
<a class="sourceLine" id="cb4-227" data-line-number="227">                   , <span class="kw">if</span> p x</a>
<a class="sourceLine" id="cb4-228" data-line-number="228">                       <span class="kw">then</span> c <span class="fu">+</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb4-229" data-line-number="229">                       <span class="kw">else</span> c</a>
<a class="sourceLine" id="cb4-230" data-line-number="230">                   )</a>
<a class="sourceLine" id="cb4-231" data-line-number="231">               ) (<span class="dv">0</span>,<span class="dv">0</span>) xs</a>
<a class="sourceLine" id="cb4-232" data-line-number="232">  tell <span class="fu">$</span> printf s cnt</a>
<a class="sourceLine" id="cb4-233" data-line-number="233">  return val</a>
<a class="sourceLine" id="cb4-234" data-line-number="234"></a>
<a class="sourceLine" id="cb4-235" data-line-number="235"><span class="co">--- | To control the formatting of printed floats in output matrices.</span></a>
<a class="sourceLine" id="cb4-236" data-line-number="236"><span class="kw">newtype</span> <span class="dt">Pfloat</span> <span class="fu">=</span> <span class="dt">Pfloat</span> {<span class="ot"> unPfloat ::</span> <span class="dt">Float</span>}</a>
<a class="sourceLine" id="cb4-237" data-line-number="237">  <span class="kw">deriving</span> (<span class="dt">Eq</span>)</a>
<a class="sourceLine" id="cb4-238" data-line-number="238"></a>
<a class="sourceLine" id="cb4-239" data-line-number="239"><span class="kw">instance</span> <span class="dt">Show</span> <span class="dt">Pfloat</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb4-240" data-line-number="240">  show x <span class="fu">=</span> printf <span class="st">&quot;%4.1f&quot;</span> (unPfloat x)</a>
<a class="sourceLine" id="cb4-241" data-line-number="241"></a>
<a class="sourceLine" id="cb4-242" data-line-number="242"><span class="ot">showFofState ::</span> (<span class="dt">Show</span> a) <span class="ot">=&gt;</span> (<span class="dt">RCState</span> <span class="ot">-&gt;</span> a) <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb4-243" data-line-number="243">showFofState g <span class="fu">=</span> unlines</a>
<a class="sourceLine" id="cb4-244" data-line-number="244">  ( <span class="st">&quot;\\begin{array}{c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|}&quot;</span> <span class="fu">:</span></a>
<a class="sourceLine" id="cb4-245" data-line-number="245">    ( (<span class="st">&quot;\\text{cars at loc. 1} &amp;&quot;</span> <span class="fu">++</span> intersperse <span class="ch">&#39;&amp;&#39;</span> (replicate <span class="dv">21</span> <span class="ch">&#39; &#39;</span>) <span class="fu">++</span> <span class="st">&quot; \\\\&quot;</span>) <span class="fu">:</span></a>
<a class="sourceLine" id="cb4-246" data-line-number="246">      [<span class="st">&quot;\\hline&quot;</span>] <span class="fu">++</span></a>
<a class="sourceLine" id="cb4-247" data-line-number="247">      intersperse <span class="st">&quot;\\hline&quot;</span></a>
<a class="sourceLine" id="cb4-248" data-line-number="248">        ( map ((<span class="fu">++</span> <span class="st">&quot; \\\\&quot;</span>) <span class="fu">.</span> intercalate <span class="st">&quot; &amp; &quot;</span>)</a>
<a class="sourceLine" id="cb4-249" data-line-number="249">              [ (show m <span class="fu">:</span>) <span class="fu">$</span> map show</a>
<a class="sourceLine" id="cb4-250" data-line-number="250">                [ g (finite m, finite n)</a>
<a class="sourceLine" id="cb4-251" data-line-number="251">                <span class="fu">|</span> n <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">20</span>]</a>
<a class="sourceLine" id="cb4-252" data-line-number="252">                ]</a>
<a class="sourceLine" id="cb4-253" data-line-number="253">              <span class="fu">|</span> m <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">20</span>]</a>
<a class="sourceLine" id="cb4-254" data-line-number="254">              ]</a>
<a class="sourceLine" id="cb4-255" data-line-number="255">        )</a>
<a class="sourceLine" id="cb4-256" data-line-number="256">      <span class="fu">++</span> [<span class="st">&quot;\\hline&quot;</span>]</a>
<a class="sourceLine" id="cb4-257" data-line-number="257">      <span class="fu">++</span> [intercalate <span class="st">&quot; &amp; &quot;</span> <span class="fu">$</span> <span class="st">&quot;\\text{cars at loc. 2:} &quot;</span> <span class="fu">:</span> [show n <span class="fu">|</span> n <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">20</span>]]]</a>
<a class="sourceLine" id="cb4-258" data-line-number="258">      <span class="fu">++</span> [<span class="st">&quot;\\end{array}&quot;</span>]</a>
<a class="sourceLine" id="cb4-259" data-line-number="259">    )</a>
<a class="sourceLine" id="cb4-260" data-line-number="260">  )</a>
<a class="sourceLine" id="cb4-261" data-line-number="261"></a>
<a class="sourceLine" id="cb4-262" data-line-number="262"><span class="ot">poisson ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="cb4-263" data-line-number="263">poisson lambda n <span class="fu">=</span> lambda&#39; <span class="fu">^</span> n&#39; <span class="fu">*</span> exp (<span class="fu">-</span>lambda&#39;) <span class="fu">/</span> fromIntegral (fact n)</a>
<a class="sourceLine" id="cb4-264" data-line-number="264"> <span class="kw">where</span> lambda&#39; <span class="fu">=</span> fromIntegral lambda</a>
<a class="sourceLine" id="cb4-265" data-line-number="265">       n&#39;      <span class="fu">=</span> fromIntegral n</a>
<a class="sourceLine" id="cb4-266" data-line-number="266"></a>
<a class="sourceLine" id="cb4-267" data-line-number="267"><span class="ot">fact ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb4-268" data-line-number="268">fact <span class="dv">0</span> <span class="fu">=</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb4-269" data-line-number="269">fact n <span class="fu">=</span> product [<span class="dv">1</span><span class="fu">..</span>n]</a>
<a class="sourceLine" id="cb4-270" data-line-number="270"></a>
<a class="sourceLine" id="cb4-271" data-line-number="271"><span class="ot">poissonVals ::</span> <span class="dt">VS.Vector</span> <span class="dv">5</span> (<span class="dt">VS.Vector</span> <span class="dv">12</span> <span class="dt">Float</span>)</a>
<a class="sourceLine" id="cb4-272" data-line-number="272">poissonVals <span class="fu">=</span> VS.generate (VS.generate <span class="fu">.</span> poisson)</a>
<a class="sourceLine" id="cb4-273" data-line-number="273"></a>
<a class="sourceLine" id="cb4-274" data-line-number="274"><span class="ot">poisson&#39; ::</span> <span class="dt">Finite</span> <span class="dv">5</span> <span class="ot">-&gt;</span> <span class="dt">Finite</span> <span class="dv">21</span> <span class="ot">-&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="cb4-275" data-line-number="275">poisson&#39; n x<span class="fu">@</span>(<span class="dt">Finite</span> x&#39;) <span class="fu">=</span></a>
<a class="sourceLine" id="cb4-276" data-line-number="276">  <span class="kw">if</span> x <span class="fu">&gt;</span> <span class="dv">11</span>  <span class="co">-- The Python code enforces this limit. And we&#39;re trying</span></a>
<a class="sourceLine" id="cb4-277" data-line-number="277">    <span class="kw">then</span> <span class="dv">0</span>   <span class="co">-- for an &quot;apples-to-apples&quot; performance comparison.</span></a>
<a class="sourceLine" id="cb4-278" data-line-number="278">    <span class="kw">else</span> poissonVals <span class="ot">`VS.index`</span> n <span class="ot">`VS.index`</span> finite x&#39;</a>
<a class="sourceLine" id="cb4-279" data-line-number="279"></a>
<a class="sourceLine" id="cb4-280" data-line-number="280"><span class="co">-- | First list element less than or equal to given threshold under the</span></a>
<a class="sourceLine" id="cb4-281" data-line-number="281"><span class="co">-- given function, or the last element if the threshold was never met.</span></a>
<a class="sourceLine" id="cb4-282" data-line-number="282"><span class="co">--</span></a>
<a class="sourceLine" id="cb4-283" data-line-number="283"><span class="co">-- A return value of &#39;Nothing&#39; indicates an empty list was given.</span></a>
<a class="sourceLine" id="cb4-284" data-line-number="284"><span class="co">-- withinOn :: Float -&gt; (a -&gt; Float) -&gt; [a] -&gt; Maybe a</span></a>
<a class="sourceLine" id="cb4-285" data-line-number="285"><span class="co">-- withinOn eps f xs = do</span></a>
<a class="sourceLine" id="cb4-286" data-line-number="286"><span class="co">--   n &lt;- withinIx eps $ map f xs</span></a>
<a class="sourceLine" id="cb4-287" data-line-number="287"><span class="co">--   return $ xs !! n</span></a>
<a class="sourceLine" id="cb4-288" data-line-number="288"></a>
<a class="sourceLine" id="cb4-289" data-line-number="289"><span class="co">-- | Index of first list element less than or equal to given threshold,</span></a>
<a class="sourceLine" id="cb4-290" data-line-number="290"><span class="co">-- or the index of the last element if the threshold was never met.</span></a>
<a class="sourceLine" id="cb4-291" data-line-number="291"><span class="co">--</span></a>
<a class="sourceLine" id="cb4-292" data-line-number="292"><span class="co">-- A return value of &#39;Nothing&#39; indicates an empty list was given.</span></a>
<a class="sourceLine" id="cb4-293" data-line-number="293"><span class="co">-- withinIx :: Float -&gt; [Float] -&gt; Maybe Int</span></a>
<a class="sourceLine" id="cb4-294" data-line-number="294"><span class="co">-- withinIx _   [] = Nothing</span></a>
<a class="sourceLine" id="cb4-295" data-line-number="295"><span class="co">-- withinIx eps xs = Just $ withinIx&#39; 0 xs</span></a>
<a class="sourceLine" id="cb4-296" data-line-number="296"><span class="co">--  where withinIx&#39; n []     = n - 1</span></a>
<a class="sourceLine" id="cb4-297" data-line-number="297"><span class="co">--        withinIx&#39; n (y:ys) = if y &lt;= eps</span></a>
<a class="sourceLine" id="cb4-298" data-line-number="298"><span class="co">--                               then n</span></a>
<a class="sourceLine" id="cb4-299" data-line-number="299"><span class="co">--                               else withinIx&#39; (n+1) ys</span></a>
<a class="sourceLine" id="cb4-300" data-line-number="300"></a>
<a class="sourceLine" id="cb4-301" data-line-number="301"><span class="co">-- | Monadically search list for first element less than or equal to</span></a>
<a class="sourceLine" id="cb4-302" data-line-number="302"><span class="co">-- given threshold under the given function, and return the last element</span></a>
<a class="sourceLine" id="cb4-303" data-line-number="303"><span class="co">-- if the threshold was never met.</span></a>
<a class="sourceLine" id="cb4-304" data-line-number="304"><span class="co">-- Return &#39;Nothing&#39; if the input list was empty.</span></a>
<a class="sourceLine" id="cb4-305" data-line-number="305"><span class="ot">withinOnM ::</span> <span class="dt">Monad</span> m</a>
<a class="sourceLine" id="cb4-306" data-line-number="306">          <span class="ot">=&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="cb4-307" data-line-number="307">          <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> m <span class="dt">Float</span>)</a>
<a class="sourceLine" id="cb4-308" data-line-number="308">          <span class="ot">-&gt;</span> [a]</a>
<a class="sourceLine" id="cb4-309" data-line-number="309">          <span class="ot">-&gt;</span> m (<span class="dt">Maybe</span> a)</a>
<a class="sourceLine" id="cb4-310" data-line-number="310">withinOnM _   _ [] <span class="fu">=</span> return <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb4-311" data-line-number="311">withinOnM eps f xs <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb4-312" data-line-number="312">  n <span class="ot">&lt;-</span> withinIxM eps <span class="fu">$</span> map f xs</a>
<a class="sourceLine" id="cb4-313" data-line-number="313">  <span class="kw">case</span> n <span class="kw">of</span></a>
<a class="sourceLine" id="cb4-314" data-line-number="314">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> return <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb4-315" data-line-number="315">    <span class="dt">Just</span> n&#39; <span class="ot">-&gt;</span> return <span class="fu">$</span> <span class="dt">Just</span> (xs <span class="fu">!!</span> n&#39;)</a>
<a class="sourceLine" id="cb4-316" data-line-number="316"></a>
<a class="sourceLine" id="cb4-317" data-line-number="317"><span class="co">-- | Monadically find index of first list element less than or equal to</span></a>
<a class="sourceLine" id="cb4-318" data-line-number="318"><span class="co">-- given threshold, or the index of the last element if the threshold</span></a>
<a class="sourceLine" id="cb4-319" data-line-number="319"><span class="co">-- was never met.</span></a>
<a class="sourceLine" id="cb4-320" data-line-number="320"><span class="co">--</span></a>
<a class="sourceLine" id="cb4-321" data-line-number="321"><span class="co">-- A return value of &#39;Nothing&#39; indicates an empty list was given.</span></a>
<a class="sourceLine" id="cb4-322" data-line-number="322"><span class="ot">withinIxM ::</span> <span class="dt">Monad</span> m</a>
<a class="sourceLine" id="cb4-323" data-line-number="323">          <span class="ot">=&gt;</span> <span class="dt">Float</span></a>
<a class="sourceLine" id="cb4-324" data-line-number="324">          <span class="ot">-&gt;</span> [m <span class="dt">Float</span>]</a>
<a class="sourceLine" id="cb4-325" data-line-number="325">          <span class="ot">-&gt;</span> m (<span class="dt">Maybe</span> <span class="dt">Int</span>)</a>
<a class="sourceLine" id="cb4-326" data-line-number="326">withinIxM _   [] <span class="fu">=</span> return <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb4-327" data-line-number="327">withinIxM eps xs <span class="fu">=</span> withinIxM&#39; <span class="dv">0</span> xs</a>
<a class="sourceLine" id="cb4-328" data-line-number="328"> <span class="kw">where</span> withinIxM&#39; n []     <span class="fu">=</span> return <span class="fu">$</span> <span class="dt">Just</span> (n <span class="fu">-</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-329" data-line-number="329">       withinIxM&#39; n (y<span class="fu">:</span>ys) <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb4-330" data-line-number="330">         y&#39; <span class="ot">&lt;-</span> y</a>
<a class="sourceLine" id="cb4-331" data-line-number="331">         <span class="kw">if</span> y&#39; <span class="fu">&lt;=</span> eps <span class="kw">then</span> return (<span class="dt">Just</span> n)</a>
<a class="sourceLine" id="cb4-332" data-line-number="332">                      <span class="kw">else</span> withinIxM&#39; (n<span class="fu">+</span><span class="dv">1</span>) ys</a>
<a class="sourceLine" id="cb4-333" data-line-number="333"></a>
<a class="sourceLine" id="cb4-334" data-line-number="334"><span class="co">-- | Expected reward for a given state, assuming equiprobable actions.</span></a>
<a class="sourceLine" id="cb4-335" data-line-number="335"><span class="co">-- testRewards :: RCState -&gt; Float</span></a>
<a class="sourceLine" id="cb4-336" data-line-number="336"><span class="co">-- testRewards s =</span></a>
<a class="sourceLine" id="cb4-337" data-line-number="337"><span class="co">--   sum [ uncurry (*) r</span></a>
<a class="sourceLine" id="cb4-338" data-line-number="338"><span class="co">--       | a  &lt;- acts</span></a>
<a class="sourceLine" id="cb4-339" data-line-number="339"><span class="co">--       , s&#39; &lt;- nextStates s a</span></a>
<a class="sourceLine" id="cb4-340" data-line-number="340"><span class="co">--       , r  &lt;- rewards s a s&#39;</span></a>
<a class="sourceLine" id="cb4-341" data-line-number="341"><span class="co">--       ] / (fromIntegral . length) acts</span></a>
<a class="sourceLine" id="cb4-342" data-line-number="342"><span class="co">--  where acts = actions s</span></a>
<a class="sourceLine" id="cb4-343" data-line-number="343"></a>
<a class="sourceLine" id="cb4-344" data-line-number="344">vsFor <span class="fu">=</span> flip VS.map</a></code></pre></div>
<h2 id="output">output</h2>
<h3 id="returnrequest-probability-distribution-functions">Return/Request Probability Distribution Functions</h3>
<figure>
<img src="img/pdfs.png" />
</figure>
<h3 id="policy-optimization">Policy optimization</h3>
<ul class="incremental">
<li>Found 440 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.</li>
</ul>
<p><strong>Found 333 policy changes.</strong></p>
<ul class="incremental">
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.</li>
</ul>
<p><strong>Found 283 policy changes.</strong></p>
<ul class="incremental">
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.<br />
</li>
<li>Found 441 state value diffs &gt; eps.</li>
</ul>
<p><strong>Found 90 policy changes.</strong></p>
<ul class="incremental">
<li>Found 219 state value diffs &gt; eps.<br />
</li>
<li>Found 148 state value diffs &gt; eps.<br />
</li>
<li>Found 122 state value diffs &gt; eps.<br />
</li>
<li>Found 84 state value diffs &gt; eps.<br />
</li>
<li>Found 42 state value diffs &gt; eps.<br />
</li>
<li>Found 0 state value diffs &gt; eps.</li>
</ul>
<p><strong>Found 22 policy changes.</strong></p>
<ul class="incremental">
<li>Found 0 state value diffs &gt; eps.</li>
</ul>
<p><strong>Found 0 policy changes.</strong></p>
<h3 id="final-policy">Final policy</h3>
<span class="math display">\[\begin{array}{c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|}
\text{cars at loc. 1} &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp;  \\
\hline
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; -1 &amp; -2 &amp; -2 &amp; -2 &amp; -3 &amp; -3 &amp; -3 &amp; -3 &amp; -3 &amp; -4 &amp; -4 &amp; -4 \\
\hline
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; -1 &amp; -1 &amp; -2 &amp; -2 &amp; -2 &amp; -2 &amp; -2 &amp; -3 &amp; -3 &amp; -3 &amp; -3 \\
\hline
2 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; -1 &amp; -1 &amp; -1 &amp; -1 &amp; -2 &amp; -2 &amp; -2 &amp; -2 &amp; -2 \\
\hline
3 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 &amp; -1 &amp; -1 &amp; -1 &amp; -1 &amp; -1 \\
\hline
4 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -1 \\
\hline
5 &amp; 1 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
6 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
7 &amp; 3 &amp; 2 &amp; 2 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
8 &amp; 3 &amp; 3 &amp; 3 &amp; 2 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
9 &amp; 4 &amp; 4 &amp; 3 &amp; 2 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
10 &amp; 5 &amp; 4 &amp; 3 &amp; 3 &amp; 2 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
11 &amp; 5 &amp; 4 &amp; 4 &amp; 3 &amp; 2 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
12 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
13 &amp; 5 &amp; 5 &amp; 4 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
14 &amp; 5 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
15 &amp; 5 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
16 &amp; 5 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
17 &amp; 5 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 2 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
18 &amp; 5 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 2 &amp; 2 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
19 &amp; 5 &amp; 5 &amp; 5 &amp; 4 &amp; 3 &amp; 3 &amp; 2 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
\hline
20 &amp; 5 &amp; 5 &amp; 5 &amp; 4 &amp; 4 &amp; 3 &amp; 2 &amp; 2 &amp; 2 &amp; 2 &amp; 2 &amp; 2 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
\hline
\text{cars at loc. 2:}  &amp; 0 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 &amp; 7 &amp; 8 &amp; 9 &amp; 10 &amp; 11 &amp; 12 &amp; 13 &amp; 14 &amp; 15 &amp; 16 &amp; 17 &amp; 18 &amp; 19 &amp; 20
\end{array}\]</span>
<h3 id="final-value-function">Final value function</h3>
<span class="math display">\[\begin{array}{c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|c|}
\text{cars at loc. 1} &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp; &amp;  \\
\hline
0 &amp; 425.4 &amp; 435.4 &amp; 445.2 &amp; 454.9 &amp; 464.2 &amp; 473.0 &amp; 481.5 &amp; 489.5 &amp; 497.3 &amp; 504.9 &amp; 512.2 &amp; 519.4 &amp; 526.2 &amp; 532.7 &amp; 539.1 &amp; 545.1 &amp; 550.9 &amp; 556.3 &amp; 561.6 &amp; 566.7 &amp; 571.6 \\
\hline
1 &amp; 435.3 &amp; 445.2 &amp; 455.1 &amp; 464.7 &amp; 474.0 &amp; 482.9 &amp; 491.3 &amp; 499.3 &amp; 506.9 &amp; 514.2 &amp; 521.4 &amp; 528.2 &amp; 534.7 &amp; 541.0 &amp; 547.1 &amp; 552.9 &amp; 558.3 &amp; 563.6 &amp; 568.7 &amp; 573.6 &amp; 578.2 \\
\hline
2 &amp; 444.7 &amp; 454.6 &amp; 464.5 &amp; 474.1 &amp; 483.4 &amp; 492.3 &amp; 500.7 &amp; 508.7 &amp; 516.2 &amp; 523.4 &amp; 530.2 &amp; 536.7 &amp; 543.0 &amp; 549.1 &amp; 554.8 &amp; 560.3 &amp; 565.6 &amp; 570.7 &amp; 575.6 &amp; 580.2 &amp; 584.6 \\
\hline
3 &amp; 453.4 &amp; 463.3 &amp; 473.2 &amp; 482.8 &amp; 492.1 &amp; 500.9 &amp; 509.3 &amp; 517.2 &amp; 524.8 &amp; 531.9 &amp; 538.6 &amp; 545.0 &amp; 551.1 &amp; 556.8 &amp; 562.3 &amp; 567.6 &amp; 572.7 &amp; 577.6 &amp; 582.2 &amp; 586.6 &amp; 590.7 \\
\hline
4 &amp; 461.3 &amp; 471.3 &amp; 481.1 &amp; 490.7 &amp; 499.9 &amp; 508.7 &amp; 517.0 &amp; 524.9 &amp; 532.4 &amp; 539.4 &amp; 546.1 &amp; 552.5 &amp; 558.5 &amp; 564.2 &amp; 569.6 &amp; 574.7 &amp; 579.6 &amp; 584.2 &amp; 588.6 &amp; 592.7 &amp; 596.6 \\
\hline
5 &amp; 469.3 &amp; 479.1 &amp; 488.7 &amp; 498.0 &amp; 507.1 &amp; 515.8 &amp; 524.0 &amp; 531.8 &amp; 539.1 &amp; 546.1 &amp; 552.7 &amp; 559.0 &amp; 564.9 &amp; 570.5 &amp; 575.8 &amp; 580.9 &amp; 585.7 &amp; 590.2 &amp; 594.6 &amp; 598.6 &amp; 602.2 \\
\hline
6 &amp; 477.1 &amp; 486.7 &amp; 496.0 &amp; 505.1 &amp; 513.8 &amp; 522.3 &amp; 530.4 &amp; 538.0 &amp; 545.2 &amp; 552.1 &amp; 558.5 &amp; 564.7 &amp; 570.5 &amp; 576.0 &amp; 581.2 &amp; 586.2 &amp; 590.9 &amp; 595.4 &amp; 599.6 &amp; 603.6 &amp; 607.1 \\
\hline
7 &amp; 484.7 &amp; 494.0 &amp; 503.1 &amp; 511.8 &amp; 520.3 &amp; 528.4 &amp; 536.3 &amp; 543.8 &amp; 550.8 &amp; 557.5 &amp; 563.8 &amp; 569.8 &amp; 575.5 &amp; 580.9 &amp; 586.0 &amp; 590.9 &amp; 595.5 &amp; 599.8 &amp; 604.0 &amp; 607.8 &amp; 611.2 \\
\hline
8 &amp; 492.0 &amp; 501.1 &amp; 509.8 &amp; 518.3 &amp; 526.4 &amp; 534.3 &amp; 541.9 &amp; 549.1 &amp; 556.0 &amp; 562.5 &amp; 568.6 &amp; 574.5 &amp; 580.0 &amp; 585.3 &amp; 590.3 &amp; 595.0 &amp; 599.5 &amp; 603.8 &amp; 607.8 &amp; 611.6 &amp; 614.9 \\
\hline
9 &amp; 499.1 &amp; 507.8 &amp; 516.3 &amp; 524.4 &amp; 532.3 &amp; 539.9 &amp; 547.1 &amp; 554.2 &amp; 560.8 &amp; 567.1 &amp; 573.1 &amp; 578.8 &amp; 584.2 &amp; 589.3 &amp; 594.1 &amp; 598.7 &amp; 603.1 &amp; 607.3 &amp; 611.2 &amp; 614.9 &amp; 618.1 \\
\hline
10 &amp; 505.8 &amp; 514.3 &amp; 522.4 &amp; 530.3 &amp; 537.9 &amp; 545.1 &amp; 552.2 &amp; 559.0 &amp; 565.4 &amp; 571.5 &amp; 577.3 &amp; 582.8 &amp; 588.0 &amp; 593.0 &amp; 597.7 &amp; 602.2 &amp; 606.4 &amp; 610.5 &amp; 614.3 &amp; 617.9 &amp; 621.0 \\
\hline
11 &amp; 512.3 &amp; 520.4 &amp; 528.3 &amp; 535.9 &amp; 543.1 &amp; 550.2 &amp; 557.0 &amp; 563.5 &amp; 569.8 &amp; 575.7 &amp; 581.3 &amp; 586.6 &amp; 591.7 &amp; 596.5 &amp; 601.0 &amp; 605.4 &amp; 609.5 &amp; 613.4 &amp; 617.2 &amp; 620.6 &amp; 623.6 \\
\hline
12 &amp; 518.4 &amp; 526.3 &amp; 533.9 &amp; 541.1 &amp; 548.2 &amp; 555.0 &amp; 561.5 &amp; 567.8 &amp; 573.9 &amp; 579.6 &amp; 585.0 &amp; 590.2 &amp; 595.1 &amp; 599.7 &amp; 604.2 &amp; 608.4 &amp; 612.4 &amp; 616.2 &amp; 619.8 &amp; 623.1 &amp; 626.1 \\
\hline
13 &amp; 524.2 &amp; 531.9 &amp; 539.1 &amp; 546.2 &amp; 553.0 &amp; 559.5 &amp; 565.8 &amp; 571.9 &amp; 577.8 &amp; 583.3 &amp; 588.6 &amp; 593.6 &amp; 598.3 &amp; 602.8 &amp; 607.1 &amp; 611.2 &amp; 615.0 &amp; 618.7 &amp; 622.2 &amp; 625.4 &amp; 628.3 \\
\hline
14 &amp; 529.6 &amp; 537.1 &amp; 544.2 &amp; 551.0 &amp; 557.5 &amp; 563.8 &amp; 569.9 &amp; 575.8 &amp; 581.5 &amp; 586.9 &amp; 591.9 &amp; 596.8 &amp; 601.3 &amp; 605.7 &amp; 609.8 &amp; 613.8 &amp; 617.5 &amp; 621.1 &amp; 624.4 &amp; 627.6 &amp; 630.3 \\
\hline
15 &amp; 534.8 &amp; 542.1 &amp; 549.0 &amp; 555.5 &amp; 561.8 &amp; 567.9 &amp; 573.8 &amp; 579.5 &amp; 585.0 &amp; 590.2 &amp; 595.1 &amp; 599.8 &amp; 604.2 &amp; 608.4 &amp; 612.4 &amp; 616.2 &amp; 619.8 &amp; 623.3 &amp; 626.5 &amp; 629.5 &amp; 632.2 \\
\hline
16 &amp; 539.7 &amp; 546.9 &amp; 553.5 &amp; 559.8 &amp; 565.9 &amp; 571.8 &amp; 577.5 &amp; 583.0 &amp; 588.4 &amp; 593.4 &amp; 598.1 &amp; 602.6 &amp; 606.9 &amp; 610.9 &amp; 614.8 &amp; 618.4 &amp; 621.9 &amp; 625.2 &amp; 628.4 &amp; 631.3 &amp; 633.9 \\
\hline
17 &amp; 544.4 &amp; 551.4 &amp; 557.8 &amp; 563.9 &amp; 569.8 &amp; 575.5 &amp; 581.0 &amp; 586.4 &amp; 591.5 &amp; 596.3 &amp; 600.9 &amp; 605.2 &amp; 609.3 &amp; 613.2 &amp; 616.9 &amp; 620.5 &amp; 623.8 &amp; 627.0 &amp; 630.0 &amp; 632.8 &amp; 635.3 \\
\hline
18 &amp; 548.9 &amp; 555.7 &amp; 561.9 &amp; 567.8 &amp; 573.5 &amp; 579.0 &amp; 584.4 &amp; 589.5 &amp; 594.3 &amp; 599.0 &amp; 603.4 &amp; 607.5 &amp; 611.5 &amp; 615.2 &amp; 618.8 &amp; 622.2 &amp; 625.4 &amp; 628.5 &amp; 631.4 &amp; 634.1 &amp; 636.5 \\
\hline
19 &amp; 553.1 &amp; 559.8 &amp; 565.8 &amp; 571.5 &amp; 577.0 &amp; 582.4 &amp; 587.5 &amp; 592.3 &amp; 597.0 &amp; 601.4 &amp; 605.5 &amp; 609.5 &amp; 613.2 &amp; 616.8 &amp; 620.2 &amp; 623.5 &amp; 626.6 &amp; 629.6 &amp; 632.4 &amp; 635.0 &amp; 637.4 \\
\hline
20 &amp; 557.1 &amp; 563.6 &amp; 569.5 &amp; 575.0 &amp; 580.4 &amp; 585.5 &amp; 590.3 &amp; 595.0 &amp; 599.4 &amp; 603.5 &amp; 607.5 &amp; 611.2 &amp; 614.8 &amp; 618.2 &amp; 621.5 &amp; 624.6 &amp; 627.6 &amp; 630.4 &amp; 633.1 &amp; 635.7 &amp; 637.9 \\
\hline
\text{cars at loc. 2:}  &amp; 0 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 &amp; 7 &amp; 8 &amp; 9 &amp; 10 &amp; 11 &amp; 12 &amp; 13 &amp; 14 &amp; 15 &amp; 16 &amp; 17 &amp; 18 &amp; 19 &amp; 20
\end{array}\]</span>
<hr />
<div class="footer">
<p>Powered by <a href="https://haskell-lang.org/">haskell</a>, <a href="https://docs.haskellstack.org/en/stable/README/">stack</a> and <a href="http://pandoc.org/">pandoc</a>.</p>
</div>
